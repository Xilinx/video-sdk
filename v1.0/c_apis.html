


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="_static/js/linkid.js"></script>
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Card Management and Recovery" href="card_management.html" />
    <link rel="prev" title="Running Multiple FFmpeg Jobs" href="running_multiple_jobs.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
<!-- 																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul> -->
																</div>
															</div>
															<script type="text/javascript" src="_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Xilinx Video SDK
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation and Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Environment Setup</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials and Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/tutorials.html">FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/filters.html">Software Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/quality_analysis.html">Visual Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/xma/xma_apps.html">XMA-based Apps</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_multiple_jobs.html">Running Multiple Jobs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">C API Programming Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-application-development-guide">General Application Development Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-allocation">Resource Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#session-creation">Session Creation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime-processing">Runtime Processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-and-linking-with-the-xilinx-video-sdk-plugins">Compiling and Linking with the Xilinx Video SDK Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="#common-xma-data-structures">Common XMA Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#alveo-u30-decoder-plugin-reference">Alveo U30 Decoder Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#decoder-interface">Decoder Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decoder-properties">Decoder Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alveo-u30-scaler-plugin-reference">Alveo U30 Scaler Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scaler-interface">Scaler Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scaler-properties">Scaler Properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mix-rate-support-with-the-scaler-plugin">Mix-Rate Support with the Scaler Plugin</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alveo-u30-encoder-plugin-reference">Alveo U30 Encoder Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encoder-interface">Encoder Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoder-properties">Encoder Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alveo-u30-look-ahead-plugin-reference">Alveo U30 Look-Ahead Plugin Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#look-ahead-interface">Look-Ahead Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#look-ahead-properties">Look-Ahead Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xvbm-api-reference">XVBM API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#buffer-pool-related-functions">Buffer Pool Related Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#buffer-related-accessor-functions">Buffer related accessor functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functions-for-reading-and-writing-buffers">Functions for reading and writing buffers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#xrm-api-reference">XRM API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#device-id-selection-with-xrm">Device ID Selection with XRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-allocation-with-xrm">Resource Allocation with XRM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reserving-multiple-job-slots">Reserving Multiple Job Slots</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="card_management.html">Card Management and Recovery</a></li>
</ul>
<p class="caption"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

            
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Xilinx Video SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>C API Programming Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="c-api-programming-guide">
<span id="id1"></span><h1>C API Programming Guide<a class="headerlink" href="#c-api-programming-guide" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id11">Overview</a></p></li>
<li><p><a class="reference internal" href="#general-application-development-guide" id="id12">General Application Development Guide</a></p></li>
<li><p><a class="reference internal" href="#compiling-and-linking-with-the-xilinx-video-sdk-plugins" id="id13">Compiling and Linking with the Xilinx Video SDK Plugins</a></p></li>
<li><p><a class="reference internal" href="#common-xma-data-structures" id="id14">Common XMA Data Structures</a></p></li>
<li><p><a class="reference internal" href="#alveo-u30-decoder-plugin-reference" id="id15">Alveo U30 Decoder Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#alveo-u30-scaler-plugin-reference" id="id16">Alveo U30 Scaler Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#alveo-u30-encoder-plugin-reference" id="id17">Alveo U30 Encoder Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#alveo-u30-look-ahead-plugin-reference" id="id18">Alveo U30 Look-Ahead Plugin Reference</a></p></li>
<li><p><a class="reference internal" href="#xvbm-api-reference" id="id19">XVBM API Reference</a></p></li>
<li><p><a class="reference internal" href="#xrm-api-reference" id="id20">XRM API Reference</a></p></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id11">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The Xilinx Video SDK provides a C-based application programming interface (API) which facilitates the integration of Alveo U30 transcoding capabilities in proprietary frameworks. This API is provided in the form plugins leveraging the Xilinx Media Accelerator (XMA) library and the Xilinx Resource Manager (XRM) library.</p>
<p class="rubric">The XMA Library</p>
<p>The XMA library (libxmaapi) is meant to simplify the development of applications managing and controlling video accelerators such as decoders, scalers, filters, and encoders. The libxmaapi is comprised of two API interfaces: the lower-edge interface and the upper-edge interface:</p>
<ul class="simple">
<li><p>The lower-edge API is an interface intended for plugin developers responsible for implementing hardware control of specific Xilinx acceleration kernels. These plugins are specialized user space drivers that are aware of the low-level interface of the hardware accelerators.</p></li>
<li><p>The upper-edge API is a higher-level, generalized interface intended for application developers responsible for integrating control of Xilinx accelerators into software frameworks such as FFmpeg, GStreamer, or proprietary frameworks.</p></li>
</ul>
<p>In the case of Alveo U30, the plugins are developed and provided by Xilinx. As such, a software developer integrating Alveo U30 cards in a proprietary framework only needs to be familiar with the XMA upper-edge API and the properties of each plugin.</p>
<p>The XMA library is included as part of the Xilinx Runtime (XRT) library. General documentation on XMA can be found in the <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xma_user_guide.html">XRT documentation</a>. The <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html">XMA Upper Edge API Library</a> section of the XRT documentation provides a complete reference of the XMA upper-edge API.</p>
<p class="rubric">The XRM Library</p>
<p>The XRM library is used to manage the hardware accelerators available in the system. XRM keeps track of total system capacity for each of the compute units such as the decoder, scaler, and encoder. The XRM library makes it possible to perform actions such as reserving, allocating and releasing resources; calculating resource load and max capacity.</p>
<p>Details about XRM can be found in <a class="reference external" href="https://xilinx.github.io/XRM/index.html">general XRM documentation</a>.</p>
<p class="rubric">The Xilinx Video SDK Plugins</p>
<p>The Xilinx Video SDK provides 4 different plugins, each corresponding to a specific hardware accelerated feature of the card:</p>
<ul class="simple">
<li><p>The decoder plugin</p></li>
<li><p>The encoder plugin</p></li>
<li><p>The lookahead plugin</p></li>
<li><p>The scaler plugin</p></li>
</ul>
<p>Any combination of plugins can be used when integrating with a proprietary framework.</p>
<p>Sample source code and applications using the Xilinx Video SDK plugins and the XMA APIs to do video encoding, decoding, scaling and transcoding can be found in the <a class="reference internal" href="examples/xma/xma_apps.html"><span class="doc">XMA Tutorials</span></a> included in this repository.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="general-application-development-guide">
<h2><a class="toc-backref" href="#id12">General Application Development Guide</a><a class="headerlink" href="#general-application-development-guide" title="Permalink to this headline">¶</a></h2>
<p>Integration layers for applications using the Xilinx Video SDK are organized around the following steps:</p>
<ol class="arabic simple">
<li><p>Initialization</p></li>
<li><p>Resource Reservation</p></li>
<li><p>Session Creation</p></li>
<li><p>Runtime Processing</p></li>
<li><p>Cleanup</p></li>
</ol>
<div class="section" id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>Applications using the plugins must first create a XRM context using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCreateContext()</span></code> function in order to establish a connection with the XRM daemon. The application must then initialize the XMA library using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xma_initialize()</span></code> function.</p>
<p>Detailled examples of how to perform these two steps in order to initialize an application can be found in all of the sample XMA applications, for instance <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/decode_only/src/xlnx_dec_xrm_interface.c">examples/xma/decode_only/src/xlnx_dec_xrm_interface.c</a>.</p>
<p>Further information about these APIs can be found in the online <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html">XRT</a> and <a class="reference external" href="https://xilinx.github.io/XRM/lib.html#global-functions">XRM</a> documentation.</p>
</div>
<div class="section" id="resource-allocation">
<h3>Resource Allocation<a class="headerlink" href="#resource-allocation" title="Permalink to this headline">¶</a></h3>
<p>After the initialization step, the application must determine on which device to run and reserve the necessary hardware resources (CUs) on that device. This is done using the XRM APIs, as described in detail in the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM API Reference Guide</span></a> below.</p>
</div>
<div class="section" id="session-creation">
<h3>Session Creation<a class="headerlink" href="#session-creation" title="Permalink to this headline">¶</a></h3>
<p>Once the resources have been allocated, the application must create dedicated plugin sessions for each of the hardware accelerators that need to be used (decoder, scaler, encoder, lookahead).</p>
<p>To create a session, the application must first initialize all the required properties and parameters of the particular plugin. It must then call the  corresponding session creation function. A complete reference for all the plugins is provided below.</p>
</div>
<div class="section" id="runtime-processing">
<h3>Runtime Processing<a class="headerlink" href="#runtime-processing" title="Permalink to this headline">¶</a></h3>
<p>The plugins provide functions to send data from the host and receive data from the device. The data is in the form of video frames (<a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a>) or encoded video data (<code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameData</span></code>), depending on the nature of the plugin. It is also possible to do zero-copy operations where frames are passed from one hardware accelerator to the next without being copied back to the host. The send and receive functions are specific to each plugin and the return code should be used to determine the next suitable action. A complete reference for all the plugins is provided below.</p>
</div>
<div class="section" id="cleanup">
<h3>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h3>
<p>When the application finishes, it should destroy each plugin session using the corresponding destroy function. Doing so will free the resources on the Alveo U30 cards for other jobs and ensure that everything is released and cleaned-up properly.</p>
<p>The application should also use the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmDestroyContext()</span></code> function to destroy the XRM session, stop the connection to the daemon and ensure all resources are properly released.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="compiling-and-linking-with-the-xilinx-video-sdk-plugins">
<h2><a class="toc-backref" href="#id13">Compiling and Linking with the Xilinx Video SDK Plugins</a><a class="headerlink" href="#compiling-and-linking-with-the-xilinx-video-sdk-plugins" title="Permalink to this headline">¶</a></h2>
<p>The plugins can be dynamically linked to the application. The required packages to build applications are XRT, XRM and XVBM. These packages provided as part of the Xilinx Video SDK.</p>
<p>To provide the necessary declarations in your application, include the following headers in your source code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;xrm.h&gt;</span>
<span class="c1">#include &lt;xmaplugin.h&gt;</span>
<span class="c1">#include &lt;xma.h&gt;</span>
<span class="c1">#include &lt;xvbm.h&gt;</span>
</pre></div>
</div>
<p>To compile and link your application with the plugins, add the following lines to your Makefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CFLAGS  += $(shell pkg-config --cflags libxma2api libxma2plugin xvbm libxrm)
LDFLAGS += $(shell pkg-config --libs   libxma2api libxma2plugin xvbm libxrm)
</pre></div>
</div>
<p>These should add the following switches to your gcc commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="n">include</span><span class="o">/</span><span class="n">xma2</span> <span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="n">include</span> <span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xvbm</span><span class="o">/</span><span class="n">include</span> <span class="o">-</span><span class="n">I</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">include</span>

<span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="n">lib</span> <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xvbm</span><span class="o">/</span><span class="n">lib</span> <span class="o">-</span><span class="n">L</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">lib</span> <span class="o">-</span><span class="n">lxma2api</span> <span class="o">-</span><span class="n">lxma2plugin</span> <span class="o">-</span><span class="n">lxvbm</span> <span class="o">-</span><span class="n">lstdc</span><span class="o">++</span> <span class="o">-</span><span class="n">lxrm</span> <span class="o">-</span><span class="n">lboost_system</span> <span class="o">-</span><span class="n">lboost_filesystem</span> <span class="o">-</span><span class="n">lboost_thread</span> <span class="o">-</span><span class="n">lboost_serialization</span> <span class="o">-</span><span class="n">luuid</span> <span class="o">-</span><span class="n">ldl</span> <span class="o">-</span><span class="n">lxrt_core</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="common-xma-data-structures">
<h2><a class="toc-backref" href="#id14">Common XMA Data Structures</a><a class="headerlink" href="#common-xma-data-structures" title="Permalink to this headline">¶</a></h2>
<dl class="c struct">
<dt id="c.XmaParameter">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaParameter</span></code><a class="headerlink" href="#c.XmaParameter" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Type-Length-Value data structure used for passing custom arguments to a plugin. The declaration of <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmaparam.h">xmaparam.h</a> file.</p>
<dl class="c struct">
<dt id="c.XmaFrameProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaFrameProperties</span></code><a class="headerlink" href="#c.XmaFrameProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing the frame dimensions for XmaFrame. The declaration of <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmabuffers.h">xmabuffers.h</a> file.</p>
<dl class="c struct">
<dt id="c.XmaFrame">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaFrame</span></code><a class="headerlink" href="#c.XmaFrame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing a raw video frame and its buffers. <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structures can be received from the decoder or sent to the encoder. They are also used as input and outputs for the scaler and the look-ahead. The declaration of <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmabuffers.h">xmabuffers.h</a> file.</p>
<p>The Xilinx Video SDK plugins supports two types of frames:</p>
<ul class="simple">
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> frames are explicitly allocated and managed by the host application. They are always copied from the host to the device and back after an operation.</p></li>
<li><p><code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> frames are automatically allocated by the plugins and are implemented using the <a class="reference internal" href="#xvbm-reference"><span class="std std-ref">XVBM library</span></a>. In multistage video pipeline, they allow for zero-copy operations where frames are passed from one hardware accelerator to the next without being copied back to the host. The frame data in the underlying XVBM buffers can be accessed by the host application using the XVBM APIs.</p></li>
</ul>
<p>The decoder plugin only supports <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> frames and the scaler, encoder and lookahead plugins support both types of frames.</p>
<dl class="c struct">
<dt id="c.XmaDataBuffer">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaDataBuffer</span></code><a class="headerlink" href="#c.XmaDataBuffer" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Data structure describing a buffer containing encoded video data. <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> structures can be sent to the decoder or received from the encoder. The declaration of <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmabuffers.h">xmabuffers.h</a> file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="alveo-u30-decoder-plugin-reference">
<h2><a class="toc-backref" href="#id15">Alveo U30 Decoder Plugin Reference</a><a class="headerlink" href="#alveo-u30-decoder-plugin-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decoder-interface">
<h3>Decoder Interface<a class="headerlink" href="#decoder-interface" title="Permalink to this headline">¶</a></h3>
<p>The external interface to the Alveo U30 decoder plugin consists of the following XMA upper-edge functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_dec_session_create" title="xma_dec_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_send_data" title="xma_dec_session_send_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_send_data()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_get_properties" title="xma_dec_session_get_properties"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_get_properties()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_dec_session_destroy" title="xma_dec_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmadecoder.h">xmadecoder.h</a> file. General reference information about these functions can be found in the <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html#decoder">Decoder</a> section of the XMA upper-edge API Library documentation. Alveo U30 specific information about these functions is provided below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_dec_session_create">
<span class="pre">XmaDecoderSession</span> <span class="pre">*</span><code class="sig-name descname"><span class="pre">xma_dec_session_create</span></code><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><span class="pre">XmaDecoderProperties</span></a> <span class="pre">*</span><em><span class="pre">dec_props</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_create" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates a decoder session and must be called prior to decoding data. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_dec_session_send_data">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_dec_session_send_data</span></code><span class="sig-paren">(</span><span class="pre">XmaDecoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><span class="pre">XmaDataBuffer</span></a> <span class="pre">*</span><em><span class="pre">data</span></em>, <span class="pre">int32_t</span> <span class="pre">*</span><em><span class="pre">data_used</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_send_data" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends input frame data to the hardware decoder by way of the plugin. The application needs to parse the input encoded stream and send one frame of data at a time in a <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> data structure.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch decoded data using the <a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a> API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, it means that the decoder is not able to consume the input data. In this case, the application can proceed with fetching the previously decoded data with the <a class="reference internal" href="#c.xma_dec_session_recv_frame" title="xma_dec_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_recv_frame()</span></code></a> function but must send the same input again until the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>.</p>
<p>Once the application has sent all the input frames to the decoder, it must notify the decoder by sending a null frame buffer with <code class="xref c c-var docutils literal notranslate"><span class="pre">is_eos</span></code> set to 1 in <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> structure. The application should then continue sending null frame buffers with <code class="xref c c-var docutils literal notranslate"><span class="pre">is_eos</span></code> set to 0 in order to flush out all the output YUV frames.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_dec_session_get_properties">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_dec_session_get_properties</span></code><span class="sig-paren">(</span><span class="pre">XmaDecoderSession</span> <span class="pre">*</span><em><span class="pre">dec_session</span></em>, <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><span class="pre">XmaFrameProperties</span></a> <span class="pre">*</span><em><span class="pre">fprops</span></em><span class="sig-paren">)</span><span class="pre">;</span><a class="headerlink" href="#c.xma_dec_session_get_properties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function returns the decoder properties such as width, height, output format, and bits per pixel.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_dec_session_recv_frame">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_dec_session_recv_frame</span></code><span class="sig-paren">(</span><span class="pre">XmaDecoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><em><span class="pre">frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_recv_frame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function tries to fetch a decoded YUV frame from the hardware accelerator.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, a valid YUV frame pointer is available in the buffer pointer of the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> argument. The decoder plugin only supports <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structures of the <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> type which are implemented using <a class="reference internal" href="#xvbm-reference"><span class="std std-ref">XVBM buffers</span></a>. The function does not copy the output frame to the host buffer, but simply provides a pointer to the output frame containing a XVBM buffer. The application must use the XVBM APIs to read, forward or release the buffer as explained in the <a class="reference internal" href="#xvbm-reference"><span class="std std-ref">XVBM library</span></a> section.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, then the decoder still needs some input data to produce a complete YUV output frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>, then the decoder has flushed out all the frames.</p>
<p>For an example of how to read and release a YUV output frame using the XVBM <a class="reference internal" href="#c.xvbm_buffer_get_host_ptr" title="xvbm_buffer_get_host_ptr"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_get_host_ptr()</span></code></a>, <a class="reference internal" href="#c.xvbm_buffer_read" title="xvbm_buffer_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_read()</span></code></a> and  <a class="reference internal" href="#c.xvbm_buffer_pool_entry_free" title="xvbm_buffer_pool_entry_free"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_pool_entry_free()</span></code></a> APIs, refer to the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/decode_only/src/xlnx_decoder.c">examples/xma/decode_only/src/xlnx_decoder.c</a> file of the sample XMA decoder app.</p>
<p>For an example of how to receive a YUV output frame and forward it to the scaler and to the encoder plugins using the XVBM the <a class="reference internal" href="#c.xvbm_buffer_refcnt_inc" title="xvbm_buffer_refcnt_inc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_refcnt_inc()</span></code></a> API, refer to the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder.c">examples/xma/transcode/src/xlnx_transcoder.c</a> file of the sample XMA transcoder application.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_dec_session_destroy">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_dec_session_destroy</span></code><span class="sig-paren">(</span><span class="pre">XmaDecoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_dec_session_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys a decoder session that was previously created with the <a class="reference internal" href="#c.xma_dec_session_create" title="xma_dec_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_dec_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="decoder-properties">
<h3>Decoder Properties<a class="headerlink" href="#decoder-properties" title="Permalink to this headline">¶</a></h3>
<p>The Alveo U30 decoder is configured using a combination of standard XMA decoder properties and custom decoder parameters, both of which are specified using a <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> data structure.</p>
<p>To facilitate application development, Xilinx recommends working with a simplified data structure from which the required <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> can be populated using a specialized function. A reusable example of this can found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/include/xlnx_transcoder_xma_props.h">examples/xma/transcode/include/xlnx_transcoder_xma_props.h</a> and <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder_xma_props.c">examples/xma/transcode/src/xlnx_transcoder_xma_props.c</a> files of the XMA transcoder example application.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt id="c.XmaDecoderProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaDecoderProperties</span></code><a class="headerlink" href="#c.XmaDecoderProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the Alveo U30 video decoder. The declaration of <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmadecoder.h">xmadecoder.h</a> file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Decoder Properties</p>
<p>When using the decoder plugin, the following members of the <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwdecoder_type</dt><dd><p>Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_MULTI_DECODER_TYPE</span></code></p>
</dd>
<dt>hwvendor_string[MAX_VENDOR_NAME]</dt><dd><p>Vendor string used to identify specific decoder requested.
Must be set to “MPSoC”</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the decoder plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 3840 for H264 and HEVC.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160 for H264 and HEVC.</p>
</dd>
<dt>bits_per_pixel</dt><dd><p>Bits per pixel for primary plane of output video.
Must be set to 8 bits per pixel.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second.
Valid values can range from 1 to integer max.</p>
</dd>
<dt>plugin_lib</dt><dd><p>The plugin library name to which the application wants to communicate.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>dev_index</dt><dd><p>The device index number on which the decoder resource has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>cu_index</dt><dd><p>The decoder coding unit(cu) index that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>channel_id</dt><dd><p>The channel number of the decoder that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>ddr_bank_index</dt><dd><p>Required property.
Must be set to -1 to let the hardware determine which DDR bank should be used for this channel.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaDecoderProperties" title="XmaDecoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDecoderProperties</span></code></a> are not applicable to the decoder plugin and should not be used.</p>
<p class="rubric">Custom U30 Decoder Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the decoder plugin:</p>
<dl class="simple">
<dt>“bitdepth”</dt><dd><p>Bits per pixel for primary plane of output video. Valid value is 8.
Should be set to the same value as the bits_per_pixel property.
10-bit support will be added in the future.</p>
</dd>
<dt>“codec_type”</dt><dd><p>Codec type.
For H264, set “codec_type” to 0.
For HEVC, set “codec_type” to 1.</p>
</dd>
<dt>“low_latency”</dt><dd><p>Setting this parameter gives out decoded frames in decode order instead of display order.
Supported values are 0 for display order and 1 for decode order.</p>
</dd>
<dt>“entropy_buffers_count”</dt><dd><p>Number of internal buffers to be used.
Valid values are 2 to 10 and default is 2 (recommended).</p>
</dd>
<dt>“zero_copy”</dt><dd><p>When enabled, the decoder plugin returns a buffer to the outframe data instead of copying data back to host memory.
This is useful in transcoder use cases where the decoder output will be used by encoder/scaler that is running on same hardware.
Currently the decoder supports only zero copy, therefore this parameter must always be set to 1.</p>
</dd>
<dt>“profile”</dt><dd><p>Profile of the input stream.
Supported are Baseline, Main and High for H264. Main profile for HEVC.</p>
</dd>
<dt>“level”</dt><dd><p>Level of the input stream.
Supported are from 1.0 to 5.1.</p>
</dd>
<dt>“chroma_mode”</dt><dd><p>Chroma mode with which the input has been encoded.
Supported mode is 420.</p>
</dd>
<dt>“scan_type”</dt><dd><p>Scan type denotes field order.
Currently decoder supports only progressive and should be set to 1.</p>
</dd>
<dt>“latency_logging”</dt><dd><p>Set to 1 to enable logging of latency information to syslog.</p>
</dd>
<dt>“splitbuff_mode”</dt><dd><p>Splitbuffmode reduces latency by handing off buffers to next pipeline stage earlier.
Set this only if we ensure that we always feed all NAL units that make up a frame in one shot to the decoder.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="alveo-u30-scaler-plugin-reference">
<h2><a class="toc-backref" href="#id16">Alveo U30 Scaler Plugin Reference</a><a class="headerlink" href="#alveo-u30-scaler-plugin-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="scaler-interface">
<h3>Scaler Interface<a class="headerlink" href="#scaler-interface" title="Permalink to this headline">¶</a></h3>
<p>The external interface to the Alveo U30 scaler plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_default_filter_coeff_set()</span></code></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_create" title="xma_scaler_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_recv_frame_list" title="xma_scaler_session_recv_frame_list"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_recv_frame_list()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_scaler_session_destroy" title="xma_scaler_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmascaler.h">xmascaler.h</a> file. General reference information about these functions can be found in the <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html#scaler">Scaler</a> section of the XMA upper-edge API library documentation. Alveo U30 specific information about these functions is provided below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_scaler_session_create">
<span class="pre">XmaScalerSession</span> <span class="pre">*</span><code class="sig-name descname"><span class="pre">xma_scaler_session_create</span></code><span class="sig-paren">(</span><span class="pre">XmaScalerProperties</span> <span class="pre">*</span><em><span class="pre">props</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_create" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates scaler session and must be called prior to sending input frames. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_scaler_session_send_frame">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_scaler_session_send_frame</span></code><span class="sig-paren">(</span><span class="pre">XmaScalerSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><em><span class="pre">frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_send_frame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends a YUV frame to the underlying XMA plugin( and eventually to hardware to scale the input frame to one or multiple resolutions. The application has to read one YUV frame data in semi-planar format at a time and update the buffer details in XmaFrame argument.</p>
<p>The application can take further action depending upon the return value from this API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch scaled output frames.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application should proceed with sending next yuv frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code> it means that the application should keep flushing the scaler.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code> then the scaler has been flushed and the pipeline can be exited.</p>
<p>Once the application has sent all the input frames to the scaler, it must notify the scaler by sending a null frame buffer in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure and flush the scaler. To flush the scaler, send a null frame buffer and call the <a class="reference internal" href="#c.xma_scaler_session_recv_frame_list" title="xma_scaler_session_recv_frame_list"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_recv_frame_list()</span></code></a> function for as long as <a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a> returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> or <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_scaler_session_recv_frame_list">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_scaler_session_recv_frame_list</span></code><span class="sig-paren">(</span><span class="pre">XmaScalerSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><span class="pre">*</span><em><span class="pre">frame_list</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_recv_frame_list" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the <a class="reference internal" href="#c.xma_scaler_session_send_frame" title="xma_scaler_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_send_frame()</span></code></a>. This function returns a list of output frames with every call until it reaches end of scaling. Return codes can only be <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> and <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_ERROR</span></code>.</p>
<p>The scaler plugin supports both <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> and <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> output buffers. The application indicates the buffer type through the <a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a> of the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> specified in the frame list.</p>
<p>When using <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_HOST_BUFFER_TYPE</span></code> buffers, the application is responsible for allocating the host memory for each frame. An example of how to do this can be found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/scale_only/src/xlnx_scal_utils.c">examples/xma/scale_only/src/xlnx_scal_utils.c</a> file of the sample XMA scaler app.</p>
<p>When using <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> buffers, the scaler plugin takes care of allocating XVBM buffers. The application can then access the buffer, release it the plugin or transfer it to another plugin using the XVBM APIs, as explained in the <a class="reference internal" href="#xvbm-reference"><span class="std std-ref">XVBM library</span></a> section. An example of a scaler session using <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> buffers can be found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_scaler.c">examples/xma/transcode/src/xlnx_scaler.c</a> file of the sample XMA transcoder app.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_scaler_session_destroy">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_scaler_session_destroy</span></code><span class="sig-paren">(</span><span class="pre">XmaScalerSession</span> <span class="pre">*</span><em><span class="pre">session</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_scaler_session_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys scaler session that was previously created with the <a class="reference internal" href="#c.xma_scaler_session_create" title="xma_scaler_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_scaler_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="scaler-properties">
<h3>Scaler Properties<a class="headerlink" href="#scaler-properties" title="Permalink to this headline">¶</a></h3>
<p>The Alveo U30 lookahead is configured using a combination of standard XMA scaler properties, standard XMA scaler input and ouput properties and custom scaler parameters, all of which are specified using <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> and <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> data structures.</p>
<p>To facilitate application development, Xilinx recommends working with a simplified data structure from which the required <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> and <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> can be populated using a specialized function. A reusable example of this can found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/include/xlnx_transcoder_xma_props.h">examples/xma/transcode/include/xlnx_transcoder_xma_props.h</a> and <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder_xma_props.c">examples/xma/transcode/src/xlnx_transcoder_xma_props.c</a> files of the XMA transcoder example application.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt id="c.XmaScalerFilterProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaScalerFilterProperties</span></code><a class="headerlink" href="#c.XmaScalerFilterProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the Alveo U30 scaler. The declaration of <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmascaler.h">xmascaler.h</a> file.</p>
<dl class="c struct">
<dt id="c.XmaScalerInOutProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaScalerInOutProperties</span></code><a class="headerlink" href="#c.XmaScalerInOutProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the input and outputs of the video scaler. The <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> data structure contains one <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> for the scaler input and an array of 8 <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> for the scaler outputs. The declaration of <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmascaler.h">xmascaler.h</a> file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Scaler Properties</p>
<p>When using the scaler plugin, the following members of the <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwencoder_type</dt><dd><p>Vendor value used to identify the scaler type.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_POLYPHASE_SCALER_TYPE</span></code>.</p>
</dd>
<dt>hwvendor_string[MAX_VENDOR_NAME]</dt><dd><p>Vendor string used to identify specific scaler requested.
Must be set to “Xilinx”</p>
</dd>
<dt>num_outputs</dt><dd><p>Number of scaler outputs.</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the scaler plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>plugin_lib</dt><dd><p>The plugin library name to which the application wants to communicate.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>dev_index</dt><dd><p>The device index number on which the decoder resource has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>cu_index</dt><dd><p>The decoder coding unit(cu) index that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>channel_id</dt><dd><p>The channel number of the decoder that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>ddr_bank_index</dt><dd><p>Must be set to -1 to let the hardware determine which DDR bank should be used for this channel.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaScalerFilterProperties" title="XmaScalerFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerFilterProperties</span></code></a> are not applicable to the scaler plugin and should not be used.</p>
<p class="rubric">XMA Scaler Input and Output Properties</p>
<p>When configuring the scaler input and outputs, the following members of the <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>format</dt><dd><p>Input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VCU_NV12_FMT_TYPE</span></code></p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are integers between 128 and 3840, in multiples of 4.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160, in multiples of 4.</p>
</dd>
<dt>stride</dt><dd><p>Stride must be set as input width aligned by 256.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second of the input stream. To specify a lower output frame rate, refer to the <a class="reference internal" href="#mix-rate-support"><span class="std std-ref">Mix-Rate Support</span></a> section below. This value is also used by the plugin to calculate the scaler load which determines how many hardware resources to allocate. Leaving the framerate undefined could lead to undefined behavior.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaScalerInOutProperties" title="XmaScalerInOutProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaScalerInOutProperties</span></code></a> are not applicable to the scaler plugin and should not be used.</p>
<p class="rubric">Custom Alveo U30 Scaler Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the scaler plugin:</p>
<dl class="simple">
<dt>“enable_pipeline”</dt><dd><p>Enable/Disable pipeline in scaler. Enabling pipeline increases the scaler speed.</p>
</dd>
<dt>“logLevel”</dt><dd><p>Enables XMA logging in scaler module. Supported values are 0 to 3.</p>
</dd>
<dt>“MixRate”</dt><dd><p>This parameter is used to configure mix-rate sessions where some scaler outputs are configured at the input frame rate and some other outputs will be configured at half the rate.
For single-rate scaling, this parameter must be set to null.
For mix-rate scaling, the application will need to create two different scaler sessions. The MixRate parameter of the first session must be set to null, and the MixRate parameter of the second session must be set to the address of the first session. See section below for more details on how to set-up mix-rate support in the scaler.</p>
</dd>
<dt>“latency_logging”</dt><dd><p>Set to 1 to enable logging of latency information to syslog. Set to 0 to disable logging.</p>
</dd>
</dl>
<div class="section" id="mix-rate-support-with-the-scaler-plugin">
<span id="mix-rate-support"></span><h4>Mix-Rate Support with the Scaler Plugin<a class="headerlink" href="#mix-rate-support-with-the-scaler-plugin" title="Permalink to this headline">¶</a></h4>
<p>The application can configure the scaler to work at mixed rate, where some output channels will be produced at the full input frame rate and some output channels will be produced at half the input frame rate.</p>
<p>Mix-rate is achieved by creating two different scaler sessions. One for full rate and the one for full and half rate (all rate) outputs.</p>
<p>Enabling mixed rate outputs requires that the following conditions be met:</p>
<ol class="arabic simple">
<li><p>The first output channel must be full rate</p></li>
<li><p>The full rate channels should be specified at the beginning followed by half rate channels, i.e., no full rate channel to be specified after half rate during session creation. This simplifies output buffer handling.</p></li>
</ol>
<p>Steps to implement full rate and half rate in application:</p>
<ol class="arabic simple">
<li><p>Create two scaler sessions, one for full rate channels and the other for full rate and half rate (all rate) channels.</p></li>
<li><p>Set the full rate session fps to half, since the full rate outputs will be received from both the sessions.</p></li>
<li><p>When creating the second session, use the address of the first session as value of the “MixRate” custom parameter. Based on this, the scaler plugin allocates more output buffers.</p></li>
<li><p>Call scaler send and receive with full rate and all rate sessions alternatively.</p></li>
</ol>
<p>For an example of how to implement mix-rate scaling, refer to the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_scaler.c">examples/xma/transcode/src/xlnx_scaler.c</a> file in the sample XMA scaler application.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="alveo-u30-encoder-plugin-reference">
<h2><a class="toc-backref" href="#id17">Alveo U30 Encoder Plugin Reference</a><a class="headerlink" href="#alveo-u30-encoder-plugin-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="encoder-interface">
<h3>Encoder Interface<a class="headerlink" href="#encoder-interface" title="Permalink to this headline">¶</a></h3>
<p>The external interface to the Alveo U30 encoder plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_enc_session_create" title="xma_enc_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_enc_session_destroy" title="xma_enc_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmaencoder.h">xmaencoder.h</a> file. The API reference for these functions can be found in the <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html#encoder">Encoder</a> section of the XMA upper-edge API Library documentation. Alveo U30 specific information about these functions are described below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_enc_session_create">
<span class="pre">XmaEncoderSession</span> <span class="pre">*</span><code class="sig-name descname"><span class="pre">xma_enc_session_create</span></code><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><span class="pre">XmaEncoderProperties</span></a> <span class="pre">*</span><em><span class="pre">enc_props</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_create" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates an encoder session and must be called prior to encoding input YUV. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_enc_session_send_frame">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_enc_session_send_frame</span></code><span class="sig-paren">(</span><span class="pre">XmaEncoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><em><span class="pre">frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_send_frame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends a YUV frame to the hardware encoder by way of the plugin.</p>
<p>Each time the application calls this function, it must provide valid pointer to a <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure containing a YUV frame in semi-planar format (<code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaBufferRef</span></code>) and information about this frame (<a class="reference internal" href="#c.XmaFrameProperties" title="XmaFrameProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrameProperties</span></code></a>).</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch the encoded data using the <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> API.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application must send the next YUV frame before calling <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a>.</p>
<p>Once the application has sent all the input frames to the encoder, it should notify the hardware by sending a null frame buffer and set <code class="xref c c-var docutils literal notranslate"><span class="pre">is_last_frame</span></code> to 1 in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> structure. If the API returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_FLUSH_AGAIN</span></code> after a null frame is sent, then the application can call <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> but must send a null frame again. Once the null frame is sent successfully, does not need to send frames anymore and can simply call <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> to flush out all the remaining output frames.</p>
<p>This function is not thread-safe. The <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> and <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> functions must be called in a serial manner by the application layer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_enc_session_recv_data">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_enc_session_recv_data</span></code><span class="sig-paren">(</span><span class="pre">XmaEncoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><span class="pre">XmaDataBuffer</span></a> <span class="pre">*</span><em><span class="pre">data</span></em>, <span class="pre">int32_t</span> <span class="pre">*</span><em><span class="pre">data_size</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_recv_data" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the function <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a>. The application must provide valid pointer to <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> and is the owner of it. The application is responsible for releasing this memory when done.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> and if <code class="xref c c-var docutils literal notranslate"><span class="pre">data_size</span></code> is greater than 0, then a valid output frame is available. The returned data (<code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code>) is valid until the next call to the <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a>, so the application must use or copy it before calling <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> again. The XMA encoder plugin is responsible for setting the fields of the <a class="reference internal" href="#c.XmaDataBuffer" title="XmaDataBuffer"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaDataBuffer</span></code></a> struct. That is, <code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code> is set by the XMA plugin and does not transfer the ownership of this buffer to the application. The application must not attempt to free <code class="xref c c-var docutils literal notranslate"><span class="pre">XmaDataBuffer.data</span></code>. The encoder plugin will recycle the data buffers in the next call to the <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> function.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, a data buffer is not ready to be returned and the length of the data buffer is set to 0.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>, the encoder has flushed all the output frames.</p>
<p>This function is not thread-safe. The <a class="reference internal" href="#c.xma_enc_session_send_frame" title="xma_enc_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_send_frame()</span></code></a> and <a class="reference internal" href="#c.xma_enc_session_recv_data" title="xma_enc_session_recv_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_recv_data()</span></code></a> functions must be called in a serial manner by the application layer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_enc_session_destroy">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_enc_session_destroy</span></code><span class="sig-paren">(</span><span class="pre">XmaEncoderSession</span> <span class="pre">*</span><em><span class="pre">session</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_enc_session_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys an encoder session that was previously created with the <a class="reference internal" href="#c.xma_enc_session_create" title="xma_enc_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_enc_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="encoder-properties">
<h3>Encoder Properties<a class="headerlink" href="#encoder-properties" title="Permalink to this headline">¶</a></h3>
<p>The Alveo U30 encoder is configured using a combination of standard XMA encoder properties and custom encoder parameters, both of which are specified using a <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> data structure.</p>
<p>To facilitate application development, Xilinx recommends working with a simplified data structure from which the required <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> can be populated using a specialized function. A reusable example of this can found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/include/xlnx_transcoder_xma_props.h">examples/xma/transcode/include/xlnx_transcoder_xma_props.h</a> and <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder_xma_props.c">examples/xma/transcode/src/xlnx_transcoder_xma_props.c</a> files of the sample XMA transcoder application.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt id="c.XmaEncoderProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaEncoderProperties</span></code><a class="headerlink" href="#c.XmaEncoderProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the Alveo U30 video encoder. The declaration of <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmaencoder.h">xmaencoder.h</a> file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Encoder Properties</p>
<p>When using the encoder plugin, the following members of the <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwencoder_type</dt><dd><p>Vendor value used to identify the encoder type.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_MULTI_ENCODER_TYPE</span></code></p>
</dd>
<dt>hwvendor_string[MAX_VENDOR_NAME]</dt><dd><p>Vendor string used to identify hardware type.
Must be set to “MPSoC”</p>
</dd>
<dt>format</dt><dd><p>Input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VCU_NV12_FMT_TYPE</span></code></p>
</dd>
<dt>bits_per_pixel</dt><dd><p>Bits per pixel for primary plane of input video.
Must be set to 8 bits per pixel.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 3840.
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 2160.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second</p>
</dd>
<dt>lookahead_depth</dt><dd><p>The lookahead module depth to give start giving lookahead data.
Supported values are 0 to 20.</p>
</dd>
<dt>rc_mode</dt><dd><p>Rate control mode for custom rate control
Supported values are 0 (custom rate control disabled) and 1 (enabled)</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the encoder plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>plugin_lib</dt><dd><p>The plugin library name to which the application wants to communicate.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>dev_index</dt><dd><p>The device index number on which the encoder resource has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>cu_index</dt><dd><p>The encoder coding unit(cu) index that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>channel_id</dt><dd><p>The channel number of the encoder that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>ddr_bank_index</dt><dd><p>Must be set to -1 to let the hardware determine which DDR bank should be used for this channel.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a> are not applicable to the encoder plugin and should not be used.</p>
<p class="rubric">Custom U30 Encoder Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the encoder plugin:</p>
<dl class="simple">
<dt>“enc_options”</dt><dd><p>For the encoder, most of the parameters are specified using a stringified INI file which is then passed to the “enc_options” <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a>. Refer to the <code class="xref c c-func docutils literal notranslate"><span class="pre">enc_update_props()</span></code> function in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_encoder.c">examples/xma/transcode/src/xlnx_encoder.c</a> file for the parameters which are sent as a string.</p>
</dd>
<dt>“latency_logging”</dt><dd><p>When enabled, it logs latency information to syslog.</p>
</dd>
<dt>“enable_hw_in_buf”</dt><dd><p>This parameter notifies whether the input buffer needs to copy from host or is already present on device.
If the yuv frame is already on device memory, set it to 1.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="alveo-u30-look-ahead-plugin-reference">
<h2><a class="toc-backref" href="#id18">Alveo U30 Look-Ahead Plugin Reference</a><a class="headerlink" href="#alveo-u30-look-ahead-plugin-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="look-ahead-interface">
<h3>Look-Ahead Interface<a class="headerlink" href="#look-ahead-interface" title="Permalink to this headline">¶</a></h3>
<p>The Alveo U30 Look-Ahead plugin is based on the Filter XMA plugin type. The external interface to the Alveo U30 lookahead plugin consists of the following XMA application-level functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#c.xma_filter_session_create" title="xma_filter_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_create()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_recv_frame" title="xma_filter_session_recv_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_recv_frame()</span></code></a></p></li>
<li><p><a class="reference internal" href="#c.xma_filter_session_destroy" title="xma_filter_session_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_destroy()</span></code></a></p></li>
</ul>
<p>The declaration of these functions can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmafilter.h">xmafilter.h</a> file. General reference information about these functions can be found in the <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xmakernels.main.html#filter">Filter</a> section of the XMA upper-edge API library documentation. Alveo U30 specific information about these functions is provided below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_filter_session_create">
<span class="pre">XmaFilterSession</span> <span class="pre">*</span><code class="sig-name descname"><span class="pre">xma_filter_session_create</span></code><span class="sig-paren">(</span><a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><span class="pre">XmaFilterProperties</span></a> <span class="pre">*</span><em><span class="pre">props</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_create" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function creates filter session and must be called prior to sending yuv frame to lookahead filter. The hardware resources required to run the session must be previously reserved using the <a class="reference internal" href="#xrm-api-reference"><span class="std std-ref">XRM APIs</span></a> and should not be released until after the session is destroyed. The number of sessions allowed depends on several factors that include: resolution, frame rate, bit depth, and the capabilities of the hardware accelerator.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_filter_session_send_frame">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_filter_session_send_frame</span></code><span class="sig-paren">(</span><span class="pre">XmaFilterSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><em><span class="pre">frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_send_frame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function sends YUV frame to the underlying XMA plugin(lower-edge interface) and eventually to lookahead module in hardware. The application has to read one YUV frame data in semi-planar format at a time and update the details of the buffer in the <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFrame</span></code></a> argument.
The application can take further action depending upon the return value from this API.</p>
<p>If this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code>, then the application can proceed to fetch lookahead side data along with the output frame.</p>
<p>If the function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SEND_MORE_DATA</span></code>, then the application should proceed with sending next YUV frame.</p>
<p>If this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>, it means the input frame has not been consumed and needs to resend the same input frame after calling receive frame.</p>
<p>Once the application sends all input frames to the lookahead module, it should continue sending null framea until all the frames have been flushed out from the lookahead.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_filter_session_recv_frame">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_filter_session_recv_frame</span></code><span class="sig-paren">(</span><span class="pre">XmaFilterSession</span> <span class="pre">*</span><em><span class="pre">session</span></em>, <a class="reference internal" href="#c.XmaFrame" title="XmaFrame"><span class="pre">XmaFrame</span></a> <span class="pre">*</span><em><span class="pre">frame</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_recv_frame" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function is called after calling the function <a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a>. If an output frame is not ready to be returned, this function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_TRY_AGAIN</span></code>. This function returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_SUCCESS</span></code> if the output frame is available.</p>
<p>The lookahead plugin provides the output frame and the application needs to release the frame after successfully sending it to the encoder and before calling the next <a class="reference internal" href="#c.xma_filter_session_send_frame" title="xma_filter_session_send_frame"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_send_frame()</span></code></a>.</p>
<p>Once the lookahead flushes all the frames, it returns <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_EOS</span></code>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xma_filter_session_destroy">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xma_filter_session_destroy</span></code><span class="sig-paren">(</span><span class="pre">XmaFilterSession</span> <span class="pre">*</span><em><span class="pre">session</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xma_filter_session_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This function destroys the filter session that was previously created with the <a class="reference internal" href="#c.xma_filter_session_create" title="xma_filter_session_create"><code class="xref c c-func docutils literal notranslate"><span class="pre">xma_filter_session_create()</span></code></a> function.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="look-ahead-properties">
<h3>Look-Ahead Properties<a class="headerlink" href="#look-ahead-properties" title="Permalink to this headline">¶</a></h3>
<p>The Alveo U30 lookahead is configured using a combination of standard XMA filter properties, standard XMA filter input and output properties and custom lookahead parameters, all of which are specified using <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> and <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structures.</p>
<p>To facilitate application development, Xilinx recommends working with a simplified data structure from which the required <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> and <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> can be populated using a specialized function. A reusable example of this can found in the <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/include/xlnx_transcoder_xma_props.h">examples/xma/transcode/include/xlnx_transcoder_xma_props.h</a> and <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder_xma_props.c">examples/xma/transcode/src/xlnx_transcoder_xma_props.c</a> files of the XMA transcoder example application.</p>
<p><strong>IMPORTANT</strong>: Xilinx recommends enabling custom rate-control when using the lookahead. This is done as follows:</p>
<ul class="simple">
<li><p>When creating the lookahead session, set the custom <code class="xref std std-option docutils literal notranslate"><span class="pre">rate_control_mode</span></code> parameter to 1 in the <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a></p></li>
<li><p>When creating the encoder session, set the standard <code class="xref std std-option docutils literal notranslate"><span class="pre">rc_mode</span></code> property to 1 in the <a class="reference internal" href="#c.XmaEncoderProperties" title="XmaEncoderProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaEncoderProperties</span></code></a></p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c struct">
<dt id="c.XmaFilterProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaFilterProperties</span></code><a class="headerlink" href="#c.XmaFilterProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the Alveo U30 lookahead function. The declaration of <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmafilter.h">xmafilter.h</a> file.</p>
<dl class="c struct">
<dt id="c.XmaFilterPortProperties">
<em class="property"><span class="pre">struct</span> </em><code class="sig-name descname"><span class="pre">XmaFilterPortProperties</span></code><a class="headerlink" href="#c.XmaFilterPortProperties" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This data structure is used to configure the input and output of the lookahead. The <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> data structure contains one <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> for the lookahead input and one <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> for the lookahead output. The declaration of <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> can be found in the <a class="reference external" href="https://github.com/Xilinx/XRT/blob/master/src/xma/include/app/xmafilter.h">xmafilter.h</a> file.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p class="rubric">Standard XMA Lookahead Filter Properties</p>
<p>When using the lookahead plugin, the following members of the <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>hwfilter_type</dt><dd><p>Vendor value used to identify the filter type.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_2D_FILTER_TYPE</span></code>.</p>
</dd>
<dt>hwvendor_string[MAX_VENDOR_NAME]</dt><dd><p>Vendor string used to identify specific filter requested.
Must be set to “Xilinx”</p>
</dd>
<dt>params</dt><dd><p>Array of custom initialization parameters.
See the next section for the list of custom parameters supported by the lookahead plugin.</p>
</dd>
<dt>param_cnt</dt><dd><p>Count of custom parameters.</p>
</dd>
<dt>plugin_lib</dt><dd><p>The plugin library name to which the application wants to communicate.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>dev_index</dt><dd><p>The device index number on which the decoder resource has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>cu_index</dt><dd><p>The decoder coding unit(cu) index that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>channel_id</dt><dd><p>The channel number of the decoder that has been allocated.
The value of this property is obtained as part of XRM resource allocation.</p>
</dd>
<dt>ddr_bank_index</dt><dd><p>Required property.
Must be set to -1 to let the hardware determine which DDR bank should be used for this channel.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaFilterProperties" title="XmaFilterProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterProperties</span></code></a> are not applicable to the lookahead plugin and should not be used.</p>
<p class="rubric">Standard XMA Lookahead Input Filter Properties</p>
<p>When configuring the lookahead input, the following members of the <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>format</dt><dd><p>Input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VCU_NV12_FMT_TYPE</span></code>.</p>
</dd>
<dt>bits_per_pixel</dt><dd><p>Bits per pixel for primary plane of input video.
Must be set to 8 bits per pixel.</p>
</dd>
<dt>width</dt><dd><p>Width in pixels of incoming video stream/data.
Valid values are even integers between 128 and 1920
Portrait mode is supported.</p>
</dd>
<dt>height</dt><dd><p>Height in pixels of incoming video stream/data.
Valid values are even integers between 128 and 1080.</p>
</dd>
<dt>stride</dt><dd><p>Stride value should be width with 256 alignment.</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> are not applicable to the lookahead input and should not be used.</p>
<p class="rubric">Standard XMA Lookahead Output Filter Properties</p>
<p>When configuring the lookahead output, the following members of the <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> data structure must be set by the application:</p>
<dl class="simple">
<dt>format</dt><dd><p>Input video format.
Must be set to <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_VCU_NV12_FMT_TYPE</span></code>.</p>
</dd>
<dt>bits_per_pixel</dt><dd><p>Bits per pixel for primary plane of input video.
Supported is 8 bits per pixel.</p>
</dd>
<dt>width</dt><dd><p>Output width in pixels for output video frame.
The value should be input width aligned by 64 and shift right by 4</p>
</dd>
<dt>height</dt><dd><p>Output height in pixels for output video frame.
The value should be input height aligned by 64 and shift right by 4</p>
</dd>
<dt>framerate</dt><dd><p>Framerate data structure specifying frame rate per second.</p>
</dd>
</dl>
<p>Other members of <a class="reference internal" href="#c.XmaFilterPortProperties" title="XmaFilterPortProperties"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaFilterPortProperties</span></code></a> are not applicable to the lookahead output and should not be used.</p>
<p class="rubric">Custom U30 Lookahead Parameters</p>
<p>In addition to the standard properties, the following <a class="reference internal" href="#c.XmaParameter" title="XmaParameter"><code class="xref c c-struct docutils literal notranslate"><span class="pre">XmaParameter</span></code></a> custom parameters are supported by the lookahead plugin:</p>
<dl class="simple">
<dt>“ip”</dt><dd><p>Intra period for the video stream.</p>
</dd>
<dt>“lookahead_depth”</dt><dd><p>Lookahead depth for the module.
Value range from 0 to 20.</p>
</dd>
<dt>“enable_hw_in_buf”</dt><dd><p>This param notifies whether the input buffer needs to copy from host or is already present on device.
Set it to 1, if the yuv frame is already on device memory.</p>
</dd>
<dt>“spatial_aq_mode”</dt><dd><p>Enable/Disable spatial aq mode.</p>
</dd>
<dt>“temporal_aq_mode”</dt><dd><p>Enable/Disable temporal aq mode.</p>
</dd>
<dt>“rate_control_mode”</dt><dd><p>Enable/Disable custom rate control mode.</p>
</dd>
<dt>“spatial_aq_gain”</dt><dd><p>Spatial aq gain ranges between 0 to 100, default is 50</p>
</dd>
<dt>“num_b_frames”</dt><dd><p>Number of B frames in a sub GOP.
Value range from 0 to Integer max.</p>
</dd>
<dt>“codec_type”</dt><dd><p>For H264 encoder, set codec type as 0 and for HEVC encoder, set it as 1.</p>
</dd>
<dt>“latency_logging”</dt><dd><p>Set to 1 to enable logging of latency information to syslog. Set to 0 to disable logging.</p>
</dd>
</dl>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="xvbm-api-reference">
<span id="xvbm-reference"></span><h2><a class="toc-backref" href="#id19">XVBM API Reference</a><a class="headerlink" href="#xvbm-api-reference" title="Permalink to this headline">¶</a></h2>
<p>The Xilinx Video Buffer Management (XVBM) library is used by the Xilinx Video SDK plugins to manage pools of video buffers. The XVBM API must be used to interact with the XVBM buffers associated with c:struct:<cite>XmaFrame</cite> frames of the <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> type.</p>
<p>The <code class="xref c c-macro docutils literal notranslate"><span class="pre">XMA_DEVICE_BUFFER_TYPE</span></code> frames and their XVBM buffers can either be directly passed to other hardware accelerators without being copied back to the host (zero-copy operation in a multistage pipeline) or copied back to the host for further processing in software.</p>
<p>If the application needs to access the content of a XVBM buffer, it must do so using the XVBM <a class="reference internal" href="#c.xvbm_buffer_get_host_ptr" title="xvbm_buffer_get_host_ptr"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_get_host_ptr()</span></code></a> and <a class="reference internal" href="#c.xvbm_buffer_read" title="xvbm_buffer_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_read()</span></code></a> APIs.</p>
<p>If a XVBM buffer is transferred to more than one other XMA plugin session, the <a class="reference internal" href="#c.xvbm_buffer_refcnt_inc" title="xvbm_buffer_refcnt_inc"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_refcnt_inc()</span></code></a> API should be used to split the buffer instead of explicitly creating copies of that buffer. For an example of this, refer to the <code class="xref c c-func docutils literal notranslate"><span class="pre">xlnx_tran_xvbm_buf_inc()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder.c">examples/xma/transcode/src/xlnx_transcoder.c</a>.</p>
<p>If a XVBM buffer is not transferred to another plugin, then the application must release the buffer with the <a class="reference internal" href="#c.xvbm_buffer_pool_entry_free" title="xvbm_buffer_pool_entry_free"><code class="xref c c-func docutils literal notranslate"><span class="pre">xvbm_buffer_pool_entry_free()</span></code></a> API. This releases the buffer back to the plugin, allowing the plugin to reuse the buffer for a subsequent frame. Typically, if all the buffers managed by a plugin are used (not freed), then the plugin won’t be able to accept new data.</p>
<p>XVBM buffers are directly managed by the Xilinx Video SDK plugins. The user application can read and release XVBM buffers, but it should not create or destroy XVBM buffers.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="section" id="buffer-pool-related-functions">
<h3>Buffer Pool Related Functions<a class="headerlink" href="#buffer-pool-related-functions" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_create">
<span class="pre">XvbmPoolHandle</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_create</span></code><span class="sig-paren">(</span><span class="pre">xclDeviceHandle</span> <em><span class="pre">d_handle</span></em>, <span class="pre">int32_t</span> <em><span class="pre">num_buffers</span></em>, <span class="pre">size_t</span> <em><span class="pre">size</span></em>, <span class="pre">uint32_t</span> <em><span class="pre">flags</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_create" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Create a memory pool and allocate device buffers. Returns XvbmPoolHandle used for all subsequent memory pool requests.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_create_by_device_id">
<span class="pre">XvbmPoolHandle</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_create_by_device_id</span></code><span class="sig-paren">(</span><span class="pre">int32_t</span> <em><span class="pre">device_id</span></em>, <span class="pre">int32_t</span> <em><span class="pre">num_buffers</span></em>, <span class="pre">size_t</span> <em><span class="pre">size</span></em>, <span class="pre">uint32_t</span> <em><span class="pre">flags</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_create_by_device_id" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Create a memory pool and allocate device buffers using a device ID. Returns XvbmPoolHandle used for all subsequent memory pool requests.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_offsets_set">
<span class="pre">void</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_offsets_set</span></code><span class="sig-paren">(</span><span class="pre">XvbmPoolHandle</span> <em><span class="pre">p_handle</span></em>, <span class="pre">uint32_t</span> <em><span class="pre">offsets</span></em>, <span class="pre">uint32_t</span> <em><span class="pre">num_offsets</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_offsets_set" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Set offsets for all buffers in the pool (useful for planes of a frame).</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_offset_get">
<span class="pre">uint32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_offset_get</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em>, <span class="pre">uint32_t</span> <em><span class="pre">offset_idx</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_offset_get" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get offset for a buffer in a pool.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_extend">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_extend</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em>, <span class="pre">int32_t</span> <em><span class="pre">num_buffers</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_extend" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Extend an existing memory pool allocating additional device buffers. Returns Number of buffers allocated to the pool. If the current number of buffers allocated is greater than the number of buffers requested, the number of buffers allocated will remain unchanged.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_num_buffers_get">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_num_buffers_get</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_num_buffers_get" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the number of buffers allocated to the pool associated with a buffer. Returns number of buffers allocated to the associated pool.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_entry_alloc">
<span class="pre">XvbmBufferHandle</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_entry_alloc</span></code><span class="sig-paren">(</span><span class="pre">XvbmPoolHandle</span> <em><span class="pre">p_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_entry_alloc" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Allocate a free buffer from a memory pool. Returns XvbmBufferHandle A non-NULL handle used for buffer operations.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_entry_free">
<span class="pre">bool</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_entry_free</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_entry_free" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Free a buffer and return it back to the memory pool free list.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_pool_destroy">
<span class="pre">void</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_pool_destroy</span></code><span class="sig-paren">(</span><span class="pre">XvbmPoolHandle</span> <em><span class="pre">p_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_pool_destroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Destroy all resources associated with a buffer pool. Returns true if entry is freed, otherwise false.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="buffer-related-accessor-functions">
<h3>Buffer related accessor functions<a class="headerlink" href="#buffer-related-accessor-functions" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt id="c.xvbm_buffer_get_bo_handle">
<span class="pre">uint32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_bo_handle</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_bo_handle" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the BO handle from a xvbmBufferHandle. Returns a valid BO handle or -1 if not valid.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_id">
<span class="pre">uint32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_id</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_id" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the buffer ID used by Host and MPSoC device. Returns an index of the buffer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_size">
<span class="pre">size_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_size</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_size" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the buffer size. Returns size of the buffer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_paddr">
<span class="pre">uint64_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_paddr</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_paddr" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the buffer physical address. Returns the physical address of the buffer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_handle">
<span class="pre">XvbmBufferHandle</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_handle</span></code><span class="sig-paren">(</span><span class="pre">XvbmPoolHandle</span> <em><span class="pre">p_handle</span></em>, <span class="pre">uint64_t</span> <em><span class="pre">paddr</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_handle" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the buffer handle given a physical address. Returns the buffer handle.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_refcnt_inc">
<span class="pre">void</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_refcnt_inc</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_refcnt_inc" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Increment the reference count of the buffer. Must be used when a buffer is used by more than one other accelerator, for instance when the output of the decoder is used by both the scaler and the encoder.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_refcnt">
<span class="pre">uint32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_refcnt</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_refcnt" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the reference count of the buffer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_get_host_ptr">
<span class="pre">void</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_get_host_ptr</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_get_host_ptr" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Get the host buffer handle. Returns the virtual pointer of the allocated host buffer.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="functions-for-reading-and-writing-buffers">
<h3>Functions for reading and writing buffers<a class="headerlink" href="#functions-for-reading-and-writing-buffers" title="Permalink to this headline">¶</a></h3>
<dl class="c function">
<dt id="c.xvbm_buffer_write">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_write</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em>, <em class="property"><span class="pre">const</span></em> <span class="pre">void</span> <em><span class="pre">src</span></em>, <span class="pre">size_t</span> <em><span class="pre">size</span></em>, <span class="pre">size_t</span> <em><span class="pre">offset</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_write" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Write a buffer to device memory. Returns 0 on success.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<dl class="c function">
<dt id="c.xvbm_buffer_read">
<span class="pre">int32_t</span> <code class="sig-name descname"><span class="pre">xvbm_buffer_read</span></code><span class="sig-paren">(</span><span class="pre">XvbmBufferHandle</span> <em><span class="pre">b_handle</span></em>, <span class="pre">void</span> <em><span class="pre">dst</span></em>, <span class="pre">size_t</span> <em><span class="pre">size</span></em>, <span class="pre">size_t</span> <em><span class="pre">offset</span></em><span class="sig-paren">)</span><a class="headerlink" href="#c.xvbm_buffer_read" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>Read a buffer from device memory. Returns 0 on success.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="xrm-api-reference">
<span id="id10"></span><h2><a class="toc-backref" href="#id20">XRM API Reference</a><a class="headerlink" href="#xrm-api-reference" title="Permalink to this headline">¶</a></h2>
<p>The Xilinx® FPGA Resource Manager (XRM) library is used to manage the hardware accelerators available in the system. XRM keeps track of total system capacity for each of the compute units such as the decoder, scaler, and encoder.</p>
<p>The XRM library includes a daemon, a command line tool and a C application programming interface (API). Using the library API, external applications can communicate with the XRM daemon and perform actions such as reserving, allocating and releasing resources; calculating resource load and max capacity.</p>
<p>More details on the XRM command line tool (xrmadm) and the XRM daemon (xrmd) can be found in the <a class="reference internal" href="card_management.html#xrmadm-and-xrmd-commands"><span class="std std-ref">xrmadm and xrmd Commands</span></a> section of the documentation.</p>
<p>The XRM C APIs are defined in <code class="file docutils literal notranslate"><span class="pre">xrm.h</span></code>. The detailed description of these APIs can be found in the <a class="reference external" href="https://xilinx.github.io/XRM/lib.html">XRM documentation</a>.</p>
<p>Applications integrating the Xilinx Video SDK plugins (such as the 4 example XMA Apps included in this repository) must use the XRM APIs for two kinds of tasks:</p>
<ul class="simple">
<li><p>Device ID selection (required for XMA initialization)</p></li>
<li><p>Resource allocation (required for XMA session creation)</p></li>
</ul>
<div class="section" id="device-id-selection-with-xrm">
<h3>Device ID Selection with XRM<a class="headerlink" href="#device-id-selection-with-xrm" title="Permalink to this headline">¶</a></h3>
<p>In order to initialize the XMA library, the ID of the device on which the job will run must be known.</p>
<ul class="simple">
<li><p>If the user provides the device ID, the application can directly perform XMA initialization based on this information.</p></li>
<li><p>If the user does not specify a device ID, the application needs to determine a valid one. It can do so by using the XRM API to calculate the load of the specific job which needs to be run, reserve resources based on the load, and retrieve the ID of the device on which the resources have been reserved. More specifically:</p>
<ol class="arabic simple">
<li><p>Calculate the channel load based on the job properties (extracted from command line arguments and/or header of the video stream)</p></li>
<li><p>Using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCheckCuPoolAvailableNum()</span></code> function, query XRM for the number of resources available based on the channel load. XRM checks all the devices available on the server and returns how many such channels can be accommodated.</p></li>
<li><p>Using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCuPoolReserve()</span></code> function, reserve the resources required for this channel load. XRM returns a reservation index.</p></li>
<li><p>Using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmReservationQuery()</span></code> function, obtain the ID of the device on which the resource has been allocated and the name of the xclbin.</p></li>
<li><p>Initialize XMA using the device ID and the xclbin information.</p></li>
</ol>
</li>
</ul>
<p>For more details, refer to the example below which provides a reference implementation of the steps described above.</p>
<ul class="simple">
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">transcode_device_init()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_transcoder_xrm_interface.c">examples/xma/transcode/src/xlnx_transcoder_xrm_interface.c</a></p></li>
</ul>
</div>
<div class="section" id="resource-allocation-with-xrm">
<h3>Resource Allocation with XRM<a class="headerlink" href="#resource-allocation-with-xrm" title="Permalink to this headline">¶</a></h3>
<p>In order to create an XMA plugin session (encoder/decoder/scaler/lookahead), the necessary the compute unit (CU) resources must first be successfully reserved and allocated.</p>
<ul class="simple">
<li><p>If the user provides device ID, the application should perform CU allocation on that particular device. If there are not enough resources available to support the specific channel load, the application should error out and exit.</p></li>
<li><p>If the user does not specify a device ID, the application should perform CU allocation using the reservation index it received during XMA initialization. In this case, the CU allocation will not fail as it has already been reserved during XMA initialization.</p></li>
</ul>
<p>For more details, refer to the examples below which provides a reference implementation of the steps described above.</p>
<ul class="simple">
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">enc_cu_alloc()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_encoder.c">examples/xma/transcode/src/xlnx_encoder.c</a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">dec_cu_alloc()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_decoder.c">examples/xma/transcode/src/xlnx_decoder.c</a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">scaler_cu_alloc()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_scaler.c">examples/xma/transcode/src/xlnx_scaler.c</a></p></li>
<li><p><code class="xref c c-func docutils literal notranslate"><span class="pre">la_allocate_xrm_cu()</span></code> function in <a class="reference external" href="https://github.com/Xilinx/video-sdk/tree/v1.0/examples/xma/transcode/src/xlnx_lookahead.c">examples/xma/transcode/src/xlnx_lookahead.c</a></p></li>
</ul>
</div>
<div class="section" id="reserving-multiple-job-slots">
<h3>Reserving Multiple Job Slots<a class="headerlink" href="#reserving-multiple-job-slots" title="Permalink to this headline">¶</a></h3>
<p>Another example of XMR API usage can be found in the <a class="reference external" href="https://github.com/Xilinx/app-jobslot-reservation-xrm/tree/master/jobSlot_reservation.cpp">source code of the job slot reservation application</a>. This example shows how to reserve as many job slots as possible given an input job description. This example works as follows:</p>
<ol class="arabic simple">
<li><p>Calculate the channel load based on a JSON job description</p></li>
<li><p>Using the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCheckCuPoolAvailableNum()</span></code> function, query XRM for the number of resources available based on the channel load. XRM checks all the devices available on the server and returns how many such channels can be accommodated.</p></li>
<li><p>Call the <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCuPoolReserve()</span></code> function as many times as there are available resources to reserve all of them.</p></li>
<li><p>Wait for the user to press Enter to relinquish the reserved resources using <code class="xref c c-func docutils literal notranslate"><span class="pre">xrmCuPoolRelinquish()</span></code>.</p></li>
</ol>
<p>This example can be used as a starting point for developing custom orchestration layers.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="card_management.html" class="btn btn-neutral float-right" title="Card Management and Recovery" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="running_multiple_jobs.html" class="btn btn-neutral float-left" title="Running Multiple FFmpeg Jobs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on December 14, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx, Inc.
                              </span>
<!-- 															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul> -->
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>