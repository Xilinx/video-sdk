<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Card Management and Recovery &mdash; Xilinx Video SDK 1.0 (Production) documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contributing to the Xilinx Video SDK" href="contributing.html" />
    <link rel="prev" title="C API Programming Guide" href="c_apis.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="index.html" class="icon icon-home"> Xilinx Video SDK
            <img src="_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation and Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Environment Setup</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials and Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/tutorials.html">FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/filters.html">Software Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/ffmpeg/quality_analysis.html">Visual Quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/xma/xma_apps.html">XMA-based Apps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_multiple_jobs.html">Running Multiple Jobs</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_apis.html">C API Programming Guide</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Card Management and Recovery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#device-bdf-identifiers">Device BDF Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ensuring-cards-are-detected">Ensuring Cards are Detected</a></li>
<li class="toctree-l2"><a class="reference internal" href="#checking-and-validating-devices">Checking and Validating Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mapping-devices-to-cards">Mapping Devices to Cards</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resetting-a-card">Resetting a Card</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recovering-a-card">Recovering a Card</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standard-recovery-flow">Standard Recovery Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-recovery-flow">Advanced Recovery Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#card-management-tools-reference-guide">Card Management Tools Reference Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#xbutil-and-xbmgmt-commands">xbutil and xbmgmt Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xrmadm-and-xrmd-commands">xrmadm and xrmd Commands</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-setup">Default Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generating-status-reports">Generating Status Reports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-unloading-hardware-accelerators">Loading/Unloading Hardware Accelerators</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-unloading-software-plugins">Loading/Unloading Software Plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-the-xrmd-daemon">Controlling the xrmd Daemon</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Xilinx Video SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Card Management and Recovery</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/card_management.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="card-management-and-recovery">
<h1>Card Management and Recovery<a class="headerlink" href="#card-management-and-recovery" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#device-bdf-identifiers" id="id6">Device BDF Identifiers</a></p></li>
<li><p><a class="reference internal" href="#ensuring-cards-are-detected" id="id7">Ensuring Cards are Detected</a></p></li>
<li><p><a class="reference internal" href="#checking-and-validating-devices" id="id8">Checking and Validating Devices</a></p></li>
<li><p><a class="reference internal" href="#mapping-devices-to-cards" id="id9">Mapping Devices to Cards</a></p></li>
<li><p><a class="reference internal" href="#resetting-a-card" id="id10">Resetting a Card</a></p></li>
<li><p><a class="reference internal" href="#recovering-a-card" id="id11">Recovering a Card</a></p></li>
<li><p><a class="reference internal" href="#card-management-tools-reference-guide" id="id12">Card Management Tools Reference Guide</a></p></li>
</ul>
</div>
<div class="section" id="device-bdf-identifiers">
<span id="bdf-identifiers"></span><h2><a class="toc-backref" href="#id6">Device BDF Identifiers</a><a class="headerlink" href="#device-bdf-identifiers" title="Permalink to this headline">¶</a></h2>
<p>There are two devices per Alveo U30 card. Each device is described by PCIe BDF (Bus:Device.Function) identifiers. BDF identifiers are used to target a specific device using the card management tools.</p>
<p>The BDF notation works as follows:</p>
<ul class="simple">
<li><p>PCI Domain number, often padded using leading zeros to four digits</p></li>
<li><p>A colon (:)</p></li>
<li><p>PCI Bus number in hexadecimal, often padded using a leading zeros to two or four digits</p></li>
<li><p>A colon (:)</p></li>
<li><p>PCI Device number in hexadecimal, often padded using a leading zero to two digits . Sometimes this is also referred to as the slot number.</p></li>
<li><p>A decimal point (.)</p></li>
<li><p>PCI Function number in hexadecimal</p></li>
</ul>
<p>Each device has two BDFs: a Management BDF and a User BDF. Only the last digit (PCI Function) will differ between the User BDF and the Management BDF.</p>
<ul class="simple">
<li><p>When using the <code class="docutils literal notranslate"><span class="pre">xbutil</span></code> command, the User BDF of the targeted device should be used. The User BDFs can be listed using the <code class="docutils literal notranslate"><span class="pre">xbutil</span> <span class="pre">examine</span></code> command.</p></li>
<li><p>When using the <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> command, the Management BDF of the targeted device should be used. The Management BDFs can be listed using the <code class="docutils literal notranslate"><span class="pre">xbmgmt</span> <span class="pre">examine</span></code> command. Running the <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> command requires sudo privileges.</p></li>
</ul>
<p>For example, the command below detected 4 devices and lists the User BDF for each of them. The last device listed has a User BDF of 0000:21:00.1, which describes Domain 0, Bus 21, Device 00, Function 1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ xbutil examine

...

Devices present
  [0000:e3:00.1] : xilinx_u30_gen3x4_base_1
  [0000:e2:00.1] : xilinx_u30_gen3x4_base_1
  [0000:22:00.1] : xilinx_u30_gen3x4_base_1
  [0000:21:00.1] : xilinx_u30_gen3x4_base_1
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="ensuring-cards-are-detected">
<span id="examining-cards"></span><h2><a class="toc-backref" href="#id7">Ensuring Cards are Detected</a><a class="headerlink" href="#ensuring-cards-are-detected" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">xbutil</span> <span class="pre">examine</span></code> commands provides useful details about your environment and can be used to ensure that your cards and devices are properly detected. In the example below, four devices are found and usable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ xbutil examine

System Configuration
  OS Name              : Linux
  Release              : 5.4.0-050400-generic
  Version              : #201911242031 SMP Mon Nov 25 01:35:10 UTC 2019
  Machine              : x86_64
  CPU Cores            : 32
  Memory               : 64078 MB
  Distribution         : Ubuntu 18.04.5 LTS
  GLIBC                : 2.27
  Model                : PowerEdge R7525

XRT
  Version              : 2.10.43
  Branch               : u30
  Hash                 : 41f6054b2c19619ceceb07bf7b662e5003388d89
  Hash Date            : 2021-05-11 09:17:17
  XOCL                 : 2.10.43, 41f6054b2c19619ceceb07bf7b662e5003388d89
  XCLMGMT              : 2.10.43, 41f6054b2c19619ceceb07bf7b662e5003388d89

Devices present
  [0000:e3:00.1] : xilinx_u30_gen3x4_base_1
  [0000:e2:00.1] : xilinx_u30_gen3x4_base_1
  [0000:22:00.1] : xilinx_u30_gen3x4_base_1
  [0000:21:00.1] : xilinx_u30_gen3x4_base_1
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="checking-and-validating-devices">
<span id="xbutil-validate"></span><h2><a class="toc-backref" href="#id8">Checking and Validating Devices</a><a class="headerlink" href="#checking-and-validating-devices" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">xbutil</span> <span class="pre">validate</span></code> command can be used to check and validate the status of the devices on your Alveo U30 cards by executing a special built-in test. In order to run this command, the XRM daemon must first be stopped, otherwise the test will error with <code class="docutils literal notranslate"><span class="pre">xclbin</span> <span class="pre">on</span> <span class="pre">card</span> <span class="pre">is</span> <span class="pre">in</span> <span class="pre">use</span></code> and <code class="docutils literal notranslate"><span class="pre">failed</span> <span class="pre">to</span> <span class="pre">load</span> <span class="pre">xclbin</span></code> messages.</p>
<ol class="arabic">
<li><p>List the User BDFs of each of the devices on all the Alveo U30 cards installed in your system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil</span> <span class="n">examine</span>
</pre></div>
</div>
</li>
<li><p>Stop the XRM daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">stop_xrmd</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>For each of the devices, run the self-checking test:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil</span> <span class="n">validate</span> <span class="o">--</span><span class="n">device</span> <span class="o">&lt;</span><span class="n">BDF</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>After all tests have been run, reload the Xilinx Video SDK environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="mapping-devices-to-cards">
<span id="id1"></span><h2><a class="toc-backref" href="#id9">Mapping Devices to Cards</a><a class="headerlink" href="#mapping-devices-to-cards" title="Permalink to this headline">¶</a></h2>
<p>Knowing which devices are on which card is useful to selectively reset or recover a card. Follow these instructions to determine the mapping of devices to cards:</p>
<ol class="arabic">
<li><p>List the Management BDFs of each of the devices on all the Alveo U30 cards installed in your system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">xbmgmt</span> <span class="n">examine</span>
</pre></div>
</div>
</li>
<li><p>For each device in your system, gather status information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">xbmgmt</span> <span class="n">examine</span> <span class="o">--</span><span class="n">device</span> <span class="o">&lt;</span><span class="n">BDF</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The command will generate a report similar to the one below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">----------------------------------------------</span>
<span class="mi">1</span><span class="o">/</span><span class="mi">1</span> <span class="p">[</span><span class="mi">0000</span><span class="p">:</span><span class="n">e3</span><span class="p">:</span><span class="mf">00.0</span><span class="p">]</span> <span class="p">:</span> <span class="n">xilinx_u30_gen3x4_base_1</span>
<span class="o">----------------------------------------------</span>
<span class="n">Flash</span> <span class="n">properties</span>
  <span class="n">Type</span>                 <span class="p">:</span> <span class="n">qspi_ps_x2_single</span>
  <span class="n">Serial</span> <span class="n">Number</span>        <span class="p">:</span> <span class="n">XFL1RT5PHT31</span>

<span class="n">Flashable</span> <span class="n">partitions</span> <span class="n">running</span> <span class="n">on</span> <span class="n">FPGA</span>
  <span class="n">Platform</span>             <span class="p">:</span> <span class="n">xilinx_u30_gen3x4_base_1</span>
  <span class="n">SC</span> <span class="n">Version</span>           <span class="p">:</span> <span class="mf">6.3.7</span><span class="p">(</span><span class="n">FIXED</span><span class="p">)</span>
  <span class="n">Platform</span> <span class="n">UUID</span>        <span class="p">:</span> <span class="mi">323002</span><span class="n">F5</span><span class="o">-</span><span class="mi">4</span><span class="n">D79</span><span class="o">-</span><span class="mi">9</span><span class="n">C04</span><span class="o">-</span><span class="mi">786</span><span class="n">D</span><span class="o">-</span><span class="n">B52BE50C3DAE</span>
  <span class="n">Interface</span> <span class="n">UUID</span>       <span class="p">:</span> <span class="mi">937</span><span class="n">ED708</span><span class="o">-</span><span class="mi">67</span><span class="n">CF</span><span class="o">-</span><span class="mi">3350</span><span class="o">-</span><span class="n">BC06</span><span class="o">-</span><span class="mi">304053</span><span class="n">F4293C</span>

<span class="n">Flashable</span> <span class="n">partitions</span> <span class="n">installed</span> <span class="ow">in</span> <span class="n">system</span>
  <span class="n">Platform</span>             <span class="p">:</span> <span class="n">xilinx_u30_gen3x4_base_1</span>
  <span class="n">SC</span> <span class="n">Version</span>           <span class="p">:</span> <span class="mf">6.3.7</span>
  <span class="n">Platform</span> <span class="n">UUID</span>        <span class="p">:</span> <span class="mi">323002</span><span class="n">F5</span><span class="o">-</span><span class="mi">4</span><span class="n">D79</span><span class="o">-</span><span class="mi">9</span><span class="n">C04</span><span class="o">-</span><span class="mi">786</span><span class="n">D</span><span class="o">-</span><span class="n">B52BE50C3DAE</span>
</pre></div>
</div>
</li>
<li><p>For each device, note the BDF and the Serial Number. Two devices with the same serial number are on the same card.</p></li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="resetting-a-card">
<span id="card-reset"></span><h2><a class="toc-backref" href="#id10">Resetting a Card</a><a class="headerlink" href="#resetting-a-card" title="Permalink to this headline">¶</a></h2>
<p>Resetting an Alveo U30 card is done with the <code class="docutils literal notranslate"><span class="pre">xbutil</span> <span class="pre">reset</span> <span class="pre">--device</span> <span class="pre">&lt;BDF&gt;</span></code> command, where BDF identifies one of the two devices on the card to be reset. <strong>IMPORTANT:</strong> Even if the command takes the BDF of a single device, the command will always reset both devices on the Alveo U30 card. It is not possible to reset only one device.</p>
<p>If you need to identify which two devices are on a given card in order reset only these two devices, refer to the <a class="reference internal" href="#mapping-devices-to-cards"><span class="std std-ref">device-to-card mapping</span></a> instructions.</p>
<ol class="arabic">
<li><p>Verify that all jobs running on both devices of the card can be safely interrupted.</p></li>
<li><p>List the User BDFs of each of the devices on all the Alveo U30 cards installed in your system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil</span> <span class="n">examine</span>
</pre></div>
</div>
</li>
<li><p>Reset one of the two devices on the card which needs to be reset. This command will reset <strong>both</strong> devices on that card, not just the specified device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xbutil</span> <span class="n">reset</span> <span class="o">--</span><span class="n">device</span> <span class="o">&lt;</span><span class="n">BDF</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p>The resetted cards and devices will not be readily usable. The hardware binaries must be reloaded on the devices before running new jobs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="recovering-a-card">
<span id="card-recovery"></span><h2><a class="toc-backref" href="#id11">Recovering a Card</a><a class="headerlink" href="#recovering-a-card" title="Permalink to this headline">¶</a></h2>
<p>In the event that your card has become corrupted and that a reset is not sufficient, you will need to recover it. This is normally be done in-band via a set of simple commands. Should the card’s flash devices become corrupted to the point where it is no longer detected by PCIe, out-of-band recovery with a JTAG cable may be required.</p>
<div class="section" id="standard-recovery-flow">
<span id="id2"></span><h3>Standard Recovery Flow<a class="headerlink" href="#standard-recovery-flow" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The instructions below assume that you are trying to recover a system which was flashed with release 0.96.0 or newer. If this is not the case, <a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">contact Xilinx</a>.</p>
</div>
<ol class="arabic">
<li><p>Set up your environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>List the Management BDF of your devices:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">xbmgmt</span> <span class="n">examine</span>
</pre></div>
</div>
<p>NOTE: There are two devices per Alveo U30 card. If you want to identify which two devices are on a given card in order recover only these two devices, refer to the <a class="reference internal" href="#mapping-devices-to-cards"><span class="std std-ref">device-to-card mapping</span></a> instructions.</p>
</li>
<li><p>For each device which needs to be recovered, run the following command to flash it with the golden image:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrt</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">xbmgmt</span> <span class="n">program</span> <span class="o">--</span><span class="n">revert</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">golden</span> <span class="o">--</span><span class="n">device</span> <span class="o">&lt;</span><span class="n">BDF</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>NOTE: You may receive an error indicating <code class="docutils literal notranslate"><span class="pre">Factory</span> <span class="pre">reset</span> <span class="pre">not</span> <span class="pre">supported.</span> <span class="pre">No</span> <span class="pre">Golden</span> <span class="pre">image</span> <span class="pre">found</span> <span class="pre">on</span> <span class="pre">flash.</span></code>. This is a known issue which is permanently resolved by following these instructions: <a class="reference internal" href="release_notes.html#flashing-the-golden-image"><span class="std std-ref">reflashing the golden image</span></a>.</p>
</li>
<li><p>Cold boot the machine when all desired devices have been reverted to factory settings.</p></li>
</ol>
</div>
<div class="section" id="advanced-recovery-flow">
<span id="id3"></span><h3>Advanced Recovery Flow<a class="headerlink" href="#advanced-recovery-flow" title="Permalink to this headline">¶</a></h3>
<p>Should there be an issue with the standard in-band recovery process, it is still possible to recover the card using out-of-band methods. Please <a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">contact Xilinx</a> for more details.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="card-management-tools-reference-guide">
<h2><a class="toc-backref" href="#id12">Card Management Tools Reference Guide</a><a class="headerlink" href="#card-management-tools-reference-guide" title="Permalink to this headline">¶</a></h2>
<p>The Xilinx Video SDK builds on the Xilinx Runtime (XRT) and the Xilinx Resource Manager (XRM) to interface with the Alveo U30 cards. The Xilinx Video SDK includes the <code class="docutils literal notranslate"><span class="pre">xbutil</span></code>, <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> and <code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> command line tools for card installation, upgrade, and management.</p>
<div class="section" id="xbutil-and-xbmgmt-commands">
<h3>xbutil and xbmgmt Commands<a class="headerlink" href="#xbutil-and-xbmgmt-commands" title="Permalink to this headline">¶</a></h3>
<p>The Xilinx® Board Utility (<code class="docutils literal notranslate"><span class="pre">xbutil</span></code>) and the Xilinx® Board Management Utility (<code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code>) are standalone command line tools used to query and administer Xilinx accelerator cards such as the Alveo U30.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">xbutil</span></code> is used to examine, identify, program, and validate the installed accelerator card(s).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> is used to flash the card firmware, examine devices, and administer the installed accelerator card(s). It requires sudo privileges when running it.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">xbutil</span></code> and <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> commands typically target one device at a time. The targeted device is specified using a PCIe BDF (Bus:Device.Function) identifier. For more details about BDF identifiers, refer to the <a class="reference internal" href="#bdf-identifiers"><span class="std std-ref">Device BDF Identifiers</span></a> section above.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">xbutil</span></code> and <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> commands are delivered as part of the Xilinx Runtime (XRT) package. The complete documentation for these commands can be found in the main XRT documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://xilinx.github.io/XRT/2021.1/html/xbutil2.html">xbutil</a></p></li>
<li><p><a class="reference external" href="https://xilinx.github.io/XRT/2021.1/html/xbmgmt2.html">xbmgmt</a></p></li>
</ul>
<p><strong>Note:</strong> Do not set the XRT_TOOLS_NEXTGEN environment variable mentioned on those pages.</p>
<p class="rubric">Migrating from legacy versions of the XRT tools</p>
<p>This release of the Xilinx Video SDK includes both the legacy version and the new generation version of the <code class="docutils literal notranslate"><span class="pre">xbutil</span></code> and <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> card management tools. The legacy version is included for backwards compatibility purposes only. Xilinx recommends using the new XRT commands when creating scripts or executing card management operations.</p>
<p>To help migrating from the legacy commands to the new commands <a class="reference external" href="https://xilinx.github.io/XRT/master/html/xbtools_map.html">the following page</a> provides tables mapping the legacy options to the new options of the <code class="docutils literal notranslate"><span class="pre">xbutil</span></code> and <code class="docutils literal notranslate"><span class="pre">xbmgmt</span></code> tools.</p>
</div>
<div class="section" id="xrmadm-and-xrmd-commands">
<span id="id5"></span><h3>xrmadm and xrmd Commands<a class="headerlink" href="#xrmadm-and-xrmd-commands" title="Permalink to this headline">¶</a></h3>
<p>The Xilinx® FPGA resource manager (XRM) is the software which manages the hardware accelerators available in the system. The XRM daemon (<code class="docutils literal notranslate"><span class="pre">xrmd</span></code>) is a background process supporting reservation, allocation, and release of hardware acceleration resources. The XRM <code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> command line tool is used to interact with the XRM daemon (<code class="docutils literal notranslate"><span class="pre">xrmd</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> command provides the following capabilities and uses a JSON file as input for each action:</p>
<ul class="simple">
<li><p>Generate status reports for each device</p></li>
<li><p>Load and unload the hardware accelerators</p></li>
<li><p>Load and unload the software plugins</p></li>
</ul>
<p>The XRM related files are installed under <code class="docutils literal notranslate"><span class="pre">/opt/xilinx/xrm/</span></code> and U30-specific XRM commands are available at <code class="docutils literal notranslate"><span class="pre">/opt/xilinx/xcdr/scripts/xrm_commands/</span></code>.</p>
<div class="section" id="default-setup">
<h4>Default Setup<a class="headerlink" href="#default-setup" title="Permalink to this headline">¶</a></h4>
<p>Sourcing the <code class="docutils literal notranslate"><span class="pre">/opt/xilinx/xcdr/setup.sh</span></code> script to set up the environment takes care of setting up XRM:</p>
<ul class="simple">
<li><p>The XRM daemon (<code class="docutils literal notranslate"><span class="pre">xrmd</span></code>) is started</p></li>
<li><p>The hardware accelerators (xclbin) and software plugins are loaded on the Alveo U30 cards</p></li>
</ul>
</div>
<div class="section" id="generating-status-reports">
<h4>Generating Status Reports<a class="headerlink" href="#generating-status-reports" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> can generate reports with the status of each device in the system. This capability is particularly useful to check the loading of each hardware accelerator.</p>
<p>To generate a report for all the devices in the system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">list_cmd</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>To generate a report for a single device specified in the json file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">list_onedevice</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>A sample JSON file for generating a report for device 0 is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;list&quot;</span><span class="p">,</span>
        <span class="s2">&quot;requestId&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-unloading-hardware-accelerators">
<h4>Loading/Unloading Hardware Accelerators<a class="headerlink" href="#loading-unloading-hardware-accelerators" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> can be used to load or unload the hardware accelerators on the programmable devices of the Alveo U30 card. The hardware accelerators must be reloaded after rebooting a card.</p>
<p>To load the hardware accelerators on a given device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">xrm_commands</span><span class="o">/</span><span class="n">load_multiple_devices</span><span class="o">/</span><span class="n">load_device0_cmd</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>To unload the hardware accelerators from a given device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">xrm_commands</span><span class="o">/</span><span class="n">unload_multiple_devices</span><span class="o">/</span><span class="n">unload_device_0_cmd</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>A sample JSON file for loading two devices (0 and 1) is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;load&quot;</span><span class="p">,</span>
        <span class="s2">&quot;requestId&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
            <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;xclbin&quot;</span><span class="p">:</span> <span class="s2">&quot;/opt/xilinx/xcdr/xclbins/transcode.xclbin&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
            <span class="s2">&quot;device&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;xclbin&quot;</span><span class="p">:</span> <span class="s2">&quot;/opt/xilinx/xcdr/xclbins/transcode.xclbin&quot;</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-unloading-software-plugins">
<h4>Loading/Unloading Software Plugins<a class="headerlink" href="#loading-unloading-software-plugins" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">xrmadm</span></code> can be used to load or unload the software plugins required to manage the compute resources. The software plugins perform resource management functions such as calculating CU load and CU max capacity. Once a plugin is loaded, it becomes usable by a host application through the XRM APIs. The XRM plugins need to be loaded before executing an application (such as FFmpeg) which relies on the plugins.</p>
<p>To load the plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">xrm_commands</span><span class="o">/</span><span class="n">load_multi_u30_xrm_plugins_cmd</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>To unload the plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xrmadm</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xcdr</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">xrm_commands</span><span class="o">/</span><span class="n">unload_multi_u30_xrm_plugins_cmd</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-the-xrmd-daemon">
<h4>Controlling the xrmd Daemon<a class="headerlink" href="#controlling-the-xrmd-daemon" title="Permalink to this headline">¶</a></h4>
<p>The following commands can be used to start, stop, restart, or get the status of the daemon:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">start_xrmd</span><span class="o">.</span><span class="n">sh</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">stop_xrmd</span><span class="o">.</span><span class="n">sh</span>
<span class="n">sudo</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">xilinx</span><span class="o">/</span><span class="n">xrm</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">restart_xrmd</span><span class="o">.</span><span class="n">sh</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">status</span> <span class="n">xrmd</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="c_apis.html" class="btn btn-neutral float-left" title="C API Programming Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contributing to the Xilinx Video SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on June 20, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>