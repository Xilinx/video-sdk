<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>FFmpeg Introductory Tutorials &mdash; Xilinx Video SDK 1.5 (Production) documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FFmpeg Examples using Software Filters" href="filters.html" />
    <link rel="prev" title="Tutorials and Examples" href="../../examples.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> Xilinx Video SDK
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_prem.html">On Premises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_vt1.html">Amazon EC2 VT1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../container_setup.html">Container Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Tutorials and Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">FFmpeg Introductory Tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-setup">Environment Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-ffmpeg-examples">Simple FFmpeg Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#decode-only">Decode Only</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encode-only">Encode Only</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-transcode">Basic Transcode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decode-only-into-multiple-resolution-outputs">Decode Only Into Multiple-Resolution Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encode-only-into-multiple-resolution-outputs">Encode Only Into Multiple-Resolution Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transcode-with-multiple-resolution-outputs">Transcode With Multiple-Resolution Outputs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lower-latency-transcode-with-multiple-resolution-outputs">Lower-Latency Transcode With Multiple-Resolution Outputs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#encoding-streams-to-4k">Encoding Streams to 4K</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#k-h-264-real-time-encode-only">4k H.264 Real-Time Encode Only</a></li>
<li class="toctree-l4"><a class="reference internal" href="#k-h-264-real-time-transcode">4k H.264 Real-Time Transcode</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-multiple-ffmpeg-jobs">Running Multiple FFmpeg Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#faster-than-real-time">Faster than Real-Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#streaming-examples">Streaming Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#replay-saved-files-with-downscaling">Replay Saved Files with Downscaling</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="filters.html">FFmpeg Software Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="quality_analysis.html">FFmpeg Visual Quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xma/xma_apps.html">C-Based Applications</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../specs_and_features.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../managing_compute_resources.html">Managing Compute Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploying_with_kubernetes.html">Deploying with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_apis.html">C API Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../card_management.html">Card Management</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Xilinx Video SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../examples.html">Tutorials and Examples</a> &raquo;</li>
      <li>FFmpeg Introductory Tutorials</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/ffmpeg/tutorials.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="ffmpeg-introductory-tutorials">
<h1>FFmpeg Introductory Tutorials<a class="headerlink" href="#ffmpeg-introductory-tutorials" title="Permalink to this heading">¶</a></h1>
<p>This page provides tutorials on how to use FFmpeg with the Xilinx Video SDK. Detailed documentation for this specific topic can be found in the Xilinx Video SDK <a class="reference internal" href="../../using_ffmpeg.html"><span class="doc">User Guide</span></a>.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#environment-setup" id="id2">Environment Setup</a></p></li>
<li><p><a class="reference internal" href="#simple-ffmpeg-examples" id="id3">Simple FFmpeg Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#decode-only" id="id4">Decode Only</a></p></li>
<li><p><a class="reference internal" href="#encode-only" id="id5">Encode Only</a></p></li>
<li><p><a class="reference internal" href="#basic-transcode" id="id6">Basic Transcode</a></p></li>
<li><p><a class="reference internal" href="#decode-only-into-multiple-resolution-outputs" id="id7">Decode Only Into Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#encode-only-into-multiple-resolution-outputs" id="id8">Encode Only Into Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#transcode-with-multiple-resolution-outputs" id="id9">Transcode With Multiple-Resolution Outputs</a></p></li>
<li><p><a class="reference internal" href="#lower-latency-transcode-with-multiple-resolution-outputs" id="id10">Lower-Latency Transcode With Multiple-Resolution Outputs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#encoding-streams-to-4k" id="id11">Encoding Streams to 4K</a></p>
<ul>
<li><p><a class="reference internal" href="#k-h-264-real-time-encode-only" id="id12">4k H.264 Real-Time Encode Only</a></p></li>
<li><p><a class="reference internal" href="#k-h-264-real-time-transcode" id="id13">4k H.264 Real-Time Transcode</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#running-multiple-ffmpeg-jobs" id="id14">Running Multiple FFmpeg Jobs</a></p></li>
<li><p><a class="reference internal" href="#faster-than-real-time" id="id15">Faster than Real-Time</a></p></li>
<li><p><a class="reference internal" href="#streaming-examples" id="id16">Streaming Examples</a></p>
<ul>
<li><p><a class="reference internal" href="#replay-saved-files-with-downscaling" id="id17">Replay Saved Files with Downscaling</a></p></li>
</ul>
</li>
</ul>
</div>
<p>The tutorials break down the commands, starting with simple steps using a single device. These are built upon to show 4K, faster than real-time, and multiple operations on the same device.</p>
<div class="section" id="environment-setup">
<h2><a class="toc-backref" href="#id2">Environment Setup</a><a class="headerlink" href="#environment-setup" title="Permalink to this heading">¶</a></h2>
<p>Ensure you have properly configured the environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<p>The setup script exports important environment variables, starts the Xilinx Resource Manager (XRM) daemon, and ensures that the Xilinx devices and the XRM plugins are properly loaded. It also moves to the top of the system PATH the FFmpeg binary provided as part of the Xilinx Video SDK.</p>
<p>Sourcing the setup script should be performed each time you open a new terminal on your system. This is required for the environment to be correctly configured.</p>
<p>Messages indicating “Failed to start xrmd.service” can safely be ignored.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="simple-ffmpeg-examples">
<h2><a class="toc-backref" href="#id3">Simple FFmpeg Examples</a><a class="headerlink" href="#simple-ffmpeg-examples" title="Permalink to this heading">¶</a></h2>
<p>Some of the examples read or write RAW files from disk (encode-only or decode-only pipelines). There is a chance that due to the massive bandwidth required for operating on these RAW files, you will notice a drop in FPS; this is not due to the Xilinx Video SDK but the disk speeds. We recommend reading/writing from <code class="docutils literal notranslate"><span class="pre">/dev/shm</span></code> which is a RAM disk.</p>
<div class="section" id="decode-only">
<span id="id1"></span><h3><a class="toc-backref" href="#id4">Decode Only</a><a class="headerlink" href="#decode-only" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/01_ffmpeg_decode_only.sh">examples/ffmpeg/tutorials/01_ffmpeg_decode_only.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./01_ffmpeg_decode_only.sh &lt;1080p60 H.264 file&gt;
</pre></div>
</div>
<p>This example accepts a clip that is already encoded in H.264, and will decode the file into a RAW format and save it to disk.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i &lt;INPUT&gt; \
-vf xvbm_convert -pix_fmt yuv420p -y /tmp/xil_dec_out.yuv
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated decoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-vf</span> <span class="pre">xvbm_convert</span></code></p>
<ul>
<li><p>Internally, the decoder operates on Xilinx-typed buffers to improve performance and enable scalable options for future accelerated filters. To convert back to a host-buffer, you must execute this filter.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>We need to define the color space in the output</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_out.yuv</span></code></p>
<ul>
<li><p>The decoder will save the file to the path above</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="encode-only">
<h3><a class="toc-backref" href="#id5">Encode Only</a><a class="headerlink" href="#encode-only" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/02_ffmpeg_encode_only_1080p.sh">examples/ffmpeg/tutorials/02_ffmpeg_encode_only_1080p.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./02_ffmpeg_encode_only_1080p.sh &lt;1080p60 YUV file&gt;
</pre></div>
</div>
<p>This example accepts a RAW 1080p60 clip in YUV420 format. It will pass the clip to the encoder to produce an H.264 encoded MP4 output with a target bitrate of 8Mbps and save it to disk.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -f rawvideo -s 1920x1080 -r 60 -pix_fmt yuv420p -i &lt;INPUT&gt; \
-b:v 8M -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_enc_out.mp4
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This signifies that the video is in a raw format, without container or other metadata/information about the clip</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">1920x1080</span></code></p>
<ul>
<li><p>Since there is no container or metadata in a RAW clip, the user must define the input clip’s resolution/size. This example states the input is 1080p</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">60</span></code></p>
<ul>
<li><p>Again, without metadata, the encoder requires the framerate of the incoming stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>The color space of the encoder is by default yuv420p. this example is defining the input clip as being this same color space</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">8M</span></code></p>
<ul>
<li><p>The target bitrate of the encoded stream. 8M signifies a target bitrate of 8 Megabits per second. You can also use 8000K or 8000000.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated encoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_enc_out.mp4</span></code></p>
<ul>
<li><p>Save the output in the path above</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="basic-transcode">
<h3><a class="toc-backref" href="#id6">Basic Transcode</a><a class="headerlink" href="#basic-transcode" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/03_ffmpeg_transcode_only.sh">examples/ffmpeg/tutorials/03_ffmpeg_transcode_only.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./03_ffmpeg_transcode_only.sh &lt;1080p60 H.264 file&gt;
</pre></div>
</div>
<p>This example takes an H.264 clip and reencodes it to H.264 with a new bitrate of 8Mbps. The output is written into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_xcode.mp4</span></code>.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i &lt;INPUT&gt; \
-f mp4 -b:v 8M -c:v mpsoc_vcu_h264 -y /tmp/xil_xcode.mp4
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated decoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">8M</span></code></p>
<ul>
<li><p>The target bitrate of the encoded stream. 8M signifies a target bitrate of 8 Megabits per second. You can also use 8000K or 8000000.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated encoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_xcode.mp4</span></code></p>
<ul>
<li><p>This is the output path; most scripts will route here. Change to any output path at your discretion.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="decode-only-into-multiple-resolution-outputs">
<span id="decode-and-scale-only"></span><h3><a class="toc-backref" href="#id7">Decode Only Into Multiple-Resolution Outputs</a><a class="headerlink" href="#decode-only-into-multiple-resolution-outputs" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/04_ffmpeg_decode_plus_scale.sh">examples/ffmpeg/tutorials/04_ffmpeg_decode_plus_scale.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./04_ffmpeg_decode_plus_scale.sh &lt;1080p60 h264 clip&gt;
</pre></div>
</div>
<p>This example decodes an existing H.264 file and then scales it into multiple resolutions as defined below. It will not re-encode them, but save the RAW outputs to disk under <code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_scale&lt;res&gt;.yuv</span></code></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720:  out_1_rate=full: \
out_2_width=848:  out_2_height=480:  out_2_rate=half: \
out_3_width=640:  out_3_height=360:  out_3_rate=half: \
out_4_width=288:  out_4_height=160:  out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]; \
[aa]xvbm_convert[aa1];[abb]xvbm_convert[abb1];[b]xvbm_convert[b1];[c]xvbm_convert[c1]; \
[d]xvbm_convert[d1]&quot; \
-map &quot;[aa1]&quot;  -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_720p60.yuv \
-map &quot;[abb1]&quot; -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_720p30.yuv \
-map &quot;[b1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_480p30.yuv \
-map &quot;[c1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_360p30.yuv \
-map &quot;[d1]&quot;   -pix_fmt yuv420p -f rawvideo /tmp/xil_dec_scale_288p30.yuv
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated decoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code>, <code class="docutils literal notranslate"><span class="pre">fps</span></code> and <code class="docutils literal notranslate"><span class="pre">xvbm_convert</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-xvbm_convert"><code class="xref std std-option docutils literal notranslate"><span class="pre">xvbm_convert</span></code></a> filters are used to transfer the outputs of the hardware scaler back to the host and convert them to AV frames for further processing by FFmpeg</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-pix_fmt</span> <span class="pre">yuv420p</span></code></p>
<ul>
<li><p>Use a yuv420p output format</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This tells ffmpeg to output the video into a RAW video file</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_dec_scale_&lt;resolution&gt;&lt;fps&gt;.yuv</span></code></p>
<ul>
<li><p>Save the output files to the paths listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="encode-only-into-multiple-resolution-outputs">
<span id="encode-only-multiple-res-outputs"></span><h3><a class="toc-backref" href="#id8">Encode Only Into Multiple-Resolution Outputs</a><a class="headerlink" href="#encode-only-into-multiple-resolution-outputs" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/05_ffmpeg_encode_plus_scale_1080p.sh">examples/ffmpeg/tutorials/05_ffmpeg_encode_plus_scale_1080p.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./05_ffmpeg_encode_plus_scale_1080p.sh &lt;1080p60 YUV file&gt;
</pre></div>
</div>
<p>This example takes a raw 1080p60 YUV file, scales it down to different resolutions and frame rates, encodes each of the scaled streams to H.264 and saves them to disk under <code class="file docutils literal notranslate"><span class="pre">xil_scale_enc_&lt;resolution&gt;.mp4</span></code></p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -f rawvideo -s 1920x1080 -r 60 -pix_fmt yuv420p -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720: out_1_rate=full:   \
out_2_width=848:  out_2_height=480: out_2_rate=half:   \
out_3_width=640:  out_3_height=360: out_3_rate=half:   \
out_4_width=288:  out_4_height=160: out_4_rate=half    \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot;  \
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_scale_enc_288p30.mp4
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">rawvideo</span></code></p>
<ul>
<li><p>This signifies that the video is in a raw format, without container or other metadata/information about the clip</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">1920x1080</span></code></p>
<ul>
<li><p>Since there is no container or metadata in a RAW clip, the user must define the input clip’s resolution/size. This example states the input is 1080p</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">60</span></code></p>
<ul>
<li><p>Without metadata, the encoder requires the framerate of the incoming stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> filters to create 5 output resolutions from the input stream.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and  <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated encoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_scale_enc_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="transcode-with-multiple-resolution-outputs">
<span id="transcode-with-abr-ladder"></span><h3><a class="toc-backref" href="#id9">Transcode With Multiple-Resolution Outputs</a><a class="headerlink" href="#transcode-with-multiple-resolution-outputs" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/06_ffmpeg_transcode_plus_scale.sh">examples/ffmpeg/tutorials/06_ffmpeg_transcode_plus_scale.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./06_ffmpeg_transcode_plus_scale.sh &lt;1080p60 h264 clip&gt;
</pre></div>
</div>
<p>This example implements a complete transcoding pipeline on an 1080p60 H.264 input. It decodes the input stream, scales it down to different resolutions and frame rates, encodes each of the scaled streams to H.264 and saves them to disk under <code class="file docutils literal notranslate"><span class="pre">xil_xcode_scale_&lt;resolution&gt;.mp4</span></code></p>
<p>The command included in the script doesn’t handle the audio channel of the input video. For an example of how to include audio in the output streams, refer to the example commented out at the bottom of the script and to the section of the documentation about <a class="reference internal" href="../../using_ffmpeg.html#mapping-audio-streams"><span class="std std-ref">Mapping Audio Streams</span></a>.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720: out_1_rate=full: \
out_2_width=848:  out_2_height=480: out_2_rate=half: \
out_3_width=640:  out_3_height=360: out_3_rate=half: \
out_4_width=288:  out_4_height=160: out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot; \
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_xcode_scale_288p30.mp4
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated decoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT&gt;</span></code></p>
<ul>
<li><p>The input file to be transcoded</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>The FFmpeg <code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code> flag allows combining multiple filters together using a graph-like syntax. This example uses the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a>, <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> filters to create 5 output resolutions from the input stream along with the corresponding audio streams.</p></li>
<li><p>The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter configures the Xilinx hardware-accelerated scaler to produce 4 output resolutions (1280x720p60, 848x480p30, 640x360p30, and 288x160p30). For each output, the width, height and frame rate are defined with <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_width</span></code>, <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_height</span></code> and  <code class="docutils literal notranslate"><span class="pre">out_&lt;n&gt;_rate</span></code>. The 4 outputs of the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-arg-multiscale_xma"><code class="xref std std-option docutils literal notranslate"><span class="pre">multiscale_xma</span></code></a> filter are identified as <code class="docutils literal notranslate"><span class="pre">a</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, <code class="docutils literal notranslate"><span class="pre">c</span></code> and <code class="docutils literal notranslate"><span class="pre">d</span></code> respectively.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">split</span></code> and <code class="docutils literal notranslate"><span class="pre">fps</span></code> software filters are used to split the <code class="docutils literal notranslate"><span class="pre">a</span></code> stream into <code class="docutils literal notranslate"><span class="pre">aa</span></code> and <code class="docutils literal notranslate"><span class="pre">ab</span></code> and then drop the framerate of <code class="docutils literal notranslate"><span class="pre">ab</span></code> to 30 fps to produce the <code class="docutils literal notranslate"><span class="pre">abb</span></code> 1280x720p30 stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects a video output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Selects an audio output of the filter graph. The selected audio stream will be combined with the selected video stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_scale_enc_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="lower-latency-transcode-with-multiple-resolution-outputs">
<h3><a class="toc-backref" href="#id10">Lower-Latency Transcode With Multiple-Resolution Outputs</a><a class="headerlink" href="#lower-latency-transcode-with-multiple-resolution-outputs" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/07_ffmpeg_transcode_plus_scale_lowlatency.sh">examples/ffmpeg/tutorials/07_ffmpeg_transcode_plus_scale_lowlatency.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./ffmpeg_transcode_plus_scale_low_latency.sh &lt;1080p60 h264 clip&gt;
</pre></div>
</div>
<p>This example is the same as #6, which is a full transcode pipeline (decode, scale, encode), saving the scaled outputs into the files <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_ll_xcode_scale_&lt;reso&gt;.mp4</span></code>. This differs in that is a “low latency” version, which removes the B-frames, and reduces the lookahead. This decreases the latency at the cost of video quality.</p>
<p>This example will output corrupt data if you provide an input file that contains B-Frames.</p>
<p>The command included in the script doesn’t handle the audio channel of the input video. For an example of how to include audio in the output streams, refer to the example commented out at the bottom of the script and to the section of the documentation about <a class="reference internal" href="../../using_ffmpeg.html#mapping-audio-streams"><span class="std std-ref">Mapping Audio Streams</span></a>.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -low_latency 1 -i $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720: out_1_rate=full:   \
out_2_width=848:  out_2_height=480: out_2_rate=half:   \
out_3_width=640:  out_3_height=360: out_3_rate=half:   \
out_4_width=288:  out_4_height=160: out_4_rate=half    \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot; \
-map &quot;[aa]&quot;  -b:v 4M    -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_720p60.mp4 \
-map &quot;[abb]&quot; -b:v 3M    -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_720p30.mp4 \
-map &quot;[b]&quot;   -b:v 2500K -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_480p30.mp4 \
-map &quot;[c]&quot;   -b:v 1250K -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_360p30.mp4 \
-map &quot;[d]&quot;   -b:v 625K  -bf 0 -scaling-list 0 -c:v mpsoc_vcu_h264 -f mp4 -y /tmp/xil_ll_xcode_scale_288p30.mp4
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span></code></p>
<ul>
<li><p>The ffmpeg application, which is provided by Xilinx, and moved to the top of the PATH when you sourced the setup.sh script</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the decoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated decoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-low_latency</span> <span class="pre">1</span></code></p>
<ul>
<li><p>This flag disables the Decoder’s ability to handle out-of-order frames (i.e. B-Frames). Decoding I and P frames only decreases the latency of the system.</p></li>
<li><p><strong>If your stream contains B-Frames, you will receive a corrupt output</strong></p></li>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">-low_latency</span> <span class="pre">1</span></code> from the command line if your input has B-Frames</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>This takes the 1080p60 input, converts it to 5x video streams of 720p60, 720p30, 480p30, 360p30, and 160p30 and creates the corresponding audio streams. For more details, refer to the previous example about Transcode With Multiple-Resolution Outputs.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-map</span> <span class="pre">&quot;[ID]&quot;</span></code></p>
<ul>
<li><p>Selects an output of the filter graph. The flags that follow apply to the selected stream.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-bf</span> <span class="pre">0</span></code></p>
<ul>
<li><p>The number of b-frames inserted in the output stream not only increases encode latency in the Xilinx device, but decode latency on the player. Setting it to 0 removes them.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">scaling-list</span> <span class="pre">0</span></code></p>
<ul>
<li><p>Disables the scaling list, which is a pre-encode processing which normally adds to the latency of the pipeline.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated encoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">mp4</span></code></p>
<ul>
<li><p>Sets the output video container to MP4</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tmp/xil_ll_xcode_scale_&lt;resolution&gt;&lt;fps&gt;.mp4</span></code></p>
<ul>
<li><p>Saves the output clips to the location listed</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="encoding-streams-to-4k">
<h2><a class="toc-backref" href="#id11">Encoding Streams to 4K</a><a class="headerlink" href="#encoding-streams-to-4k" title="Permalink to this heading">¶</a></h2>
<p>The Xilinx Video SDK supports real-time decoding and encoding of 4k streams with the following notes:</p>
<ul class="simple">
<li><p>The Xilinx video pipeline is optimized for live-streaming use cases. For 4k streams with bitrates significantly higher than the ones typically used for live streaming, it may not be possible to sustain real-time performance.</p></li>
<li><p>When decoding 4k streams with a high bitrate, increasing the number of entropy buffers using the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-entropy_buffers_count"><code class="xref std std-option docutils literal notranslate"><span class="pre">-entropy_buffers_count</span></code></a> option can help improve performance</p></li>
<li><p>When encoding raw video to 4k, set the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-s"><code class="xref std std-option docutils literal notranslate"><span class="pre">-s</span></code></a> option to <code class="docutils literal notranslate"><span class="pre">3840x2160</span></code> to specify the desired resolution.</p></li>
<li><p>When encoding 4k streams to H.264, the <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance. A value of 4 is recommended. This option is not required when encoding to HEVC.</p></li>
<li><p>The lookahead feature is not supported for 4k. FFmpeg will give an error if <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-lookahead_depth"><code class="xref std std-option docutils literal notranslate"><span class="pre">-lookahead_depth</span></code></a> is enabled when encoding to 4k.</p></li>
</ul>
<div class="section" id="k-h-264-real-time-encode-only">
<h3><a class="toc-backref" href="#id12">4k H.264 Real-Time Encode Only</a><a class="headerlink" href="#k-h-264-real-time-encode-only" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/08_ffmpeg_encode_only_4k.sh">examples/ffmpeg/tutorials/08_ffmpeg_encode_only_4k.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./08_ffmpeg_encode_only_4k.sh &lt;2160p60 YUV file&gt;
</pre></div>
</div>
<p>This example takes an 8-bit, YUV420, 2160p60 RAW file, encodes it to H.264 at a rate of 20Mbps and writes the result into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_4k_enc_out.mp4</span></code>. The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance when encoding a 4k stream to H.264.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -f rawvideo -s 3840x2160 -r 60 -pix_fmt yuv420p -i &lt;INPUT&gt; \
-b:v 20M -c:v mpsoc_vcu_h264 -slices 4 -f mp4 -y /tmp/xil_4k_enc_out.mp4
</pre></div>
</div>
</div>
<div class="section" id="k-h-264-real-time-transcode">
<h3><a class="toc-backref" href="#id13">4k H.264 Real-Time Transcode</a><a class="headerlink" href="#k-h-264-real-time-transcode" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/09_ffmpeg_transcode_only_4k.sh">examples/ffmpeg/tutorials/09_ffmpeg_transcode_only_4k.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./09_ffmpeg_transcode_only_4k.sh &lt;2160p60 HEVC file&gt;
</pre></div>
</div>
<p>This example takes an 2160p60 HEVC file, transcodes it to H.264 at a rate of 20Mbps and writes the result into <code class="file docutils literal notranslate"><span class="pre">/tmp/xil_4k_enc_out.mp4</span></code>. The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-slices"><code class="xref std std-option docutils literal notranslate"><span class="pre">-slices</span></code></a> option is required to sustain real-time performance when encoding a 4k stream to H.264.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_hevc -i &lt;INPUT&gt; \
-b:v 20M -c:v mpsoc_vcu_h264 -slices 4 -f mp4 -y /tmp/xil_4k_xcode.mp4
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="running-multiple-ffmpeg-jobs">
<span id="multiple-ffmpeg-jobs-example"></span><h2><a class="toc-backref" href="#id14">Running Multiple FFmpeg Jobs</a><a class="headerlink" href="#running-multiple-ffmpeg-jobs" title="Permalink to this heading">¶</a></h2>
<p>So far we’ve run one job at a time, even if the job does not use all the resources available on the device. The Video SDK makes it possible to run multiple FFmpeg jobs in parallel on a device or across multiple devices.</p>
<p>This script transcodes three H264 streams to HEVC, sending the outputs to /tmp/xil_xcode_{n}.mp4. The three transcodes are run in parallel in individual xterms. The FFmpeg <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-xlnx_hwdev"><code class="xref std std-option docutils literal notranslate"><span class="pre">-xlnx_hwdev</span></code></a> is used to control on which device each job is run. The first job is run on device #0 and the two others jobs are run on device #1. After the jobs are launched, a JSON system load report is generated.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example leverages the <code class="docutils literal notranslate"><span class="pre">xterm</span></code> program. Make sure it is installed on your system before proceeding.</p>
</div>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/10_ffmpeg_multiple_jobs.sh">examples/ffmpeg/tutorials/10_ffmpeg_multiple_jobs.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./10_ffmpeg_multiple_jobs.sh &lt;input_h264_1_mp4&gt; &lt;input_h264_2_mp4&gt; &lt;input_h264_3_mp4&gt;
</pre></div>
</div>
<p><strong>Commands</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Launch the three jobs in parallel
xterm -fa mono:size=9 -hold -e &quot;ffmpeg -xlnx_hwdev 0 -c:v mpsoc_vcu_h264 -i $1 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_1.mp4&quot; &amp;
xterm -fa mono:size=9 -hold -e &quot;ffmpeg -xlnx_hwdev 1 -c:v mpsoc_vcu_h264 -i $2 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_2.mp4&quot; &amp;
xterm -fa mono:size=9 -hold -e &quot;ffmpeg -xlnx_hwdev 1 -c:v mpsoc_vcu_h264 -i $3 -f mp4 -c:v mpsoc_vcu_hevc -y /tmp/xil_xcode_3.mp4&quot; &amp;

# Wait until the jobs are started to generate a system load report
sleep 2s
xrmadm /opt/xilinx/xrm/test/list_cmd.json &amp;
</pre></div>
</div>
<p><strong>Tutorial steps</strong></p>
<ul>
<li><p>Prepare 3 input H264 videos with the following resolutions: 4k60, 1080p60 and 720p30</p></li>
<li><p>Confirm there are a least two devices available in your system:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>xbutil examine
</pre></div>
</div>
</li>
<li><p>Run the example script with the 3 input videos:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./10_ffmpeg_multiple_jobs.sh 4k60.mp4 1080p60.mp4 720p30.mp4
</pre></div>
</div>
</li>
<li><p>The script opens three xterm windows and runs a transcode job in each of them. After 2 seconds, to ensure all jobs are running, the script executes the <code class="docutils literal notranslate"><span class="pre">xrmadm</span> <span class="pre">/opt/xilinx/xrm/test/list_cmd.json</span></code> command to generate a report of the system load.</p></li>
<li><p>In each of the xterm windows, inspect the FFmpeg transcript and observe that it indicates on which device the job is run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>device_id   :  0
</pre></div>
</div>
</li>
<li><p>Inspect the system load report (in JSON format) in the main terminal. For each device, the loading percentage is reported in the <code class="docutils literal notranslate"><span class="pre">usedLoad</span></code> field for each of the decoder, scaler, and encoder compute units. A value of 0 indicates that a particular resources is completely free. A value of 1000000 indicates that a particular resource is fully loaded and can no longer accept jobs. In the example shown below, the decoder is 25% utilized and can therefore accept more jobs.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;cu_3&quot;: {
    &quot;cuId         &quot;: &quot;3&quot;,
    &quot;cuType       &quot;: &quot;IP Kernel&quot;,
    &quot;kernelName   &quot;: &quot;decoder&quot;,
    &quot;kernelAlias  &quot;: &quot;DECODER_MPSOC&quot;,
    &quot;instanceName &quot;: &quot;decoder_1&quot;,
    &quot;cuName       &quot;: &quot;decoder:decoder_1&quot;,
    &quot;kernelPlugin &quot;: &quot;/opt/xilinx/xma_plugins/libvcu-xma-dec-plg.so&quot;,
    &quot;maxCapacity  &quot;: &quot;497664000&quot;,
    &quot;numChanInuse &quot;: &quot;1&quot;,
    &quot;usedLoad     &quot;: &quot;250000 of 1000000&quot;,
    &quot;reservedLoad &quot;: &quot;0 of 1000000&quot;,
    &quot;resrvUsedLoad&quot;: &quot;0 of 1000000&quot;
}
</pre></div>
</div>
</li>
<li><p>Close the three xterm windows</p></li>
<li><p>Now rerun the script with the input files in a different order:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./10_ffmpeg_multiple_jobs.sh 720p30.mp4 4k60.mp4 1080p60.mp4
</pre></div>
</div>
<p>This will try to simultaneously run the 4k60 and the 1080p60 jobs on device #1. The compute requirements of these two combined jobs will exceed the capacity of a single device. Only one of the two jobs will proceed and the second one will error out due to insufficient resources.</p>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="faster-than-real-time">
<span id="faster-than-realtime-example"></span><h2><a class="toc-backref" href="#id15">Faster than Real-Time</a><a class="headerlink" href="#faster-than-real-time" title="Permalink to this heading">¶</a></h2>
<p>Xilinx devices and the Xilinx Video SDK are optimized for low latency “real-time” applications. That is to say, they provide deterministic low latency transcoding, while operating at the FPS the human eye would normally process/watch it. This is ideal for ingesting a live video stream where there is minimal buffering.</p>
<p>When processing file-based video clips, it is possible to run faster than real time (FTRT) by using a map-reduce approach. With this method, the file-based video clip is split into multiple smaller segments, and each of these segments is individually transcoded. The more devices are available, the more segments can be processed in parallel and the faster the process is. While there is some overhead in “splitting” the clip into segments, and “stitching” the results of each segment into a single output file, these costs are almost always outweighed by the improvement in FPS.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">13_ffmpeg_transcode_only_split_stitch.py</span></code> script starts by automatically detecting the number of devices available in the system and then determines how many jobs can be run on each device based on the resolution of the input file. The input file is then split in as many segments aligning on GOP boundaries. Parallel FFmpeg jobs are submited to transcode all the segments simultaneously. The <a class="reference internal" href="../../using_ffmpeg.html#cmdoption-xlnx_hwdev"><code class="xref std std-option docutils literal notranslate"><span class="pre">-xlnx_hwdev</span></code></a> option is used to dispatch each job on a specific device. Once all the segments have been processed, FFmpeg is used to concatenate the results and form the final output stream.</p>
<p>Currently, the script only supports videos with a 16:9 aspect ratio and a resolution of 1280x720 or more.</p>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/13_ffmpeg_transcode_only_split_stitch.py">examples/ffmpeg/tutorials/13_ffmpeg_transcode_only_split_stitch.py</a></p></li>
</ul>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python 13_ffmpeg_transcode_only_split_stitch.py \
-s &lt;INPUT_FILE&gt; -d &lt;OUTPUT_FILE&gt; -i &lt;INPUT_CODEC&gt; -o &lt;OUTPUT_CODEC&gt; -b &lt;BITRATE&gt;
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">python</span></code></p>
<ul>
<li><p>This calls the local system python to execute. This has been tested on Python3 only.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-s</span> <span class="pre">&lt;INPUT_FILE&gt;</span></code></p>
<ul>
<li><p>This is the name of the pre-encoded input file (not RAW) in either H.264 or h.265 (HEVC) format.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">&lt;OUTPUT_FILE&gt;</span></code></p>
<ul>
<li><p>This is the name of the output file.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-i</span> <span class="pre">&lt;INPUT_FORMAT&gt;</span></code></p>
<ul>
<li><p>This defines the input file’s pre-encoded format: supported formats are <code class="docutils literal notranslate"><span class="pre">h264</span></code>, <code class="docutils literal notranslate"><span class="pre">hevc</span></code>, and <code class="docutils literal notranslate"><span class="pre">h265</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">h265</span></code> and <code class="docutils literal notranslate"><span class="pre">hevc</span></code> are identical; they are provided for ease of customer use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">&lt;OUTPUT_CODEC&gt;</span></code></p>
<ul>
<li><p>This defines the desired output encoder format: supported formats are <code class="docutils literal notranslate"><span class="pre">h264</span></code>, <code class="docutils literal notranslate"><span class="pre">hevc</span></code>, and <code class="docutils literal notranslate"><span class="pre">h265</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">h265</span></code> and <code class="docutils literal notranslate"><span class="pre">hevc</span></code> are identical; they are provided for ease of customer use.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">&lt;BITRATE&gt;</span></code></p>
<ul>
<li><p>This is a float or integer value which defines the output file’s target bitrate in Mbits/s. Valid values are comprised between 1.0 and 25.0. The default value is 5.0. Example: use -b 3 to specify an output bitrate of 3Mbits/s.</p></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="streaming-examples">
<h2><a class="toc-backref" href="#id16">Streaming Examples</a><a class="headerlink" href="#streaming-examples" title="Permalink to this heading">¶</a></h2>
<p>Streaming Examples operate largely on the same principles (and command line strings) as file-based operations. However, the main difference is how streams are received and transmitted.</p>
<p>These examples is will leverage example #6, which is a full transcode pipeline (decode, scale, encode), however, instead of saving the scaled outputs into monolithic MP4 files, will create a “manifest” file <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> for streaming along with several <code class="docutils literal notranslate"><span class="pre">.ts</span></code> files with the actual playback data. These manifest files, when inspected, will contain a “playlist” of clips with <code class="docutils literal notranslate"><span class="pre">.ts</span></code> extensions, which are of duration <code class="docutils literal notranslate"><span class="pre">hls_time</span></code>. Creating separate clips enables the remote playback players to “drop quality” instantaneously without any buffering to the viewer, or trying to figure out and seek to “where we are in the clip”. This is how most live streaming is done, however there are other, similar protocols (e.g. DASH) which operate on similar principles.</p>
<p>These flags, and others, are defined further on the <a class="reference external" href="https://ffmpeg.org/ffmpeg-formats.html">FFmpeg main help page</a></p>
<div class="section" id="replay-saved-files-with-downscaling">
<h3><a class="toc-backref" href="#id17">Replay Saved Files with Downscaling</a><a class="headerlink" href="#replay-saved-files-with-downscaling" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>Example script: <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/ffmpeg/tutorials/12_ffmpeg_streaming_transcode_from_file.sh">examples/ffmpeg/tutorials/12_ffmpeg_streaming_transcode_from_file.sh</a></p></li>
</ul>
<p><strong>Usage</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./12_ffmpeg_streaming_transcode_from_file.sh &lt;1080p60 h264 clip&gt;
</pre></div>
</div>
<p>The flows is for representative use.</p>
<p>The command included in the script doesn’t handle the audio channel of the input video. For an example of how to include audio in the output streams, refer to the example commented out at the bottom of the script and to the section of the documentation about <a class="reference internal" href="../../using_ffmpeg.html#mapping-audio-streams"><span class="std std-ref">Mapping Audio Streams</span></a>.</p>
<p><strong>Command Line</strong>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ffmpeg -c:v mpsoc_vcu_h264 -i  $1 \
-filter_complex &quot;multiscale_xma=outputs=4: \
out_1_width=1280: out_1_height=720:  out_1_rate=full: \
out_2_width=848:  out_2_height=480:  out_2_rate=half: \
out_3_width=640:  out_3_height=360:  out_3_rate=half: \
out_4_width=288:  out_4_height=160:  out_4_rate=half  \
[a][b][c][d]; [a]split[aa][ab]; [ab]fps=30[abb]&quot; \
-map &quot;[aa]&quot;  -b:v 4M    -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_720p60.m3u8 \
-map &quot;[abb]&quot; -b:v 3M    -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_720p30.m3u8 \
-map &quot;[b]&quot;   -b:v 2500K -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_480p30.m3u8 \
-map &quot;[c]&quot;   -b:v 1250K -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_360p30.m3u8 \
-map &quot;[d]&quot;   -b:v 625K  -c:v mpsoc_vcu_h264 -f hls -hls_time 4 -hls_list_size 5 -hls_flags delete_segments -y /var/www/html/xil_xcode_stream_scale_288p30.m3u8
</pre></div>
</div>
<p>Explanation of the flags:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ffmpeg</span> <span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span> <span class="pre">-i</span> <span class="pre">$1</span></code></p>
<ul>
<li><p>This calls the Xilinx FFmpeg, decodes using the Xilinx hardware decoder, an input file <code class="docutils literal notranslate"><span class="pre">$1</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-filter_complex</span></code></p>
<ul>
<li><p>This takes the 1080p60 input, converts it to 5x video streams of 720p60, 720p30, 480p30, 360p30, and 160p30 and creates the corresponding audio streams</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-b:v</span> <span class="pre">&lt;SIZE&gt;</span></code></p>
<ul>
<li><p>The flag signifies the desired output bitrate for each mapped stream</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-c:v</span> <span class="pre">mpsoc_vcu_h264</span></code></p>
<ul>
<li><p>Declares the encoder’s codec for video (as opposed to audio <code class="docutils literal notranslate"><span class="pre">-c:a</span> <span class="pre">...</span></code>) is the hardware-accelerated encoder in the Xilinx device</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-f</span> <span class="pre">hls</span></code></p>
<ul>
<li><p>Sets the output video container to an HLS manifest file <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> and the actual clip data <code class="docutils literal notranslate"><span class="pre">.ts</span></code> files.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls_time</span> <span class="pre">4</span></code></p>
<ul>
<li><p>This sets the duration of all the HLS clips to 4 seconds</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls_list_size</span> <span class="pre">5</span></code></p>
<ul>
<li><p>This sets the list of accessible/available clips to 5. Can be used to prebuffer the player at the remote end.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-hls</span> <span class="pre">flags</span> <span class="pre">delete_segments</span></code></p>
<ul>
<li><p>This flag will delete all segments after the <code class="docutils literal notranslate"><span class="pre">hls_list_size</span></code> is reached, saving disk space.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">-y</span></code></p>
<ul>
<li><p>Enable overwrite without prompting the user if they’re sure</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">/var/www/html/xil_xcode_stream_scale&lt;resolution&gt;&lt;fps&gt;.m3u8</span></code></p>
<ul>
<li><p>Saves the output clips, split into size of <code class="docutils literal notranslate"><span class="pre">hls_time</span></code> into <code class="docutils literal notranslate"><span class="pre">.ts</span></code> clips, indexed by the <code class="docutils literal notranslate"><span class="pre">.m3u8</span></code> manifest file.</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../examples.html" class="btn btn-neutral float-left" title="Tutorials and Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="filters.html" class="btn btn-neutral float-right" title="FFmpeg Examples using Software Filters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on April 21, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>