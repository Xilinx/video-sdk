<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>XMA Examples for the Xilinx Video SDK &mdash; Xilinx Video SDK 1.5 (Production) documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Specs and Features of the Xilinx Video SDK" href="../../specs_and_features.html" />
    <link rel="prev" title="Video Quality Examples" href="../ffmpeg/quality_analysis.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> Xilinx Video SDK
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_prem.html">On Premises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started_on_vt1.html">Amazon EC2 VT1</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../container_setup.html">Container Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Tutorials and Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ffmpeg/tutorials.html">FFmpeg Introductory Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ffmpeg/filters.html">FFmpeg Software Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ffmpeg/quality_analysis.html">FFmpeg Visual Quality</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">C-Based Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#build-and-test-instructions">Build and Test Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xma-decoder-app">XMA Decoder App</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#decoder-build-instructions">Decoder Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decoder-test-instructions">Decoder Test Instructions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xma-encoder-app">XMA Encoder App</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#encoder-build-instructions">﻿Encoder Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encoder-test-instructions">﻿Encoder Test Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations-of-the-encoder-app">Limitations of the Encoder App</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xma-scaler-app">XMA Scaler App</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#scaler-build-instructions">﻿Scaler Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scaler-test-instructions">﻿Scaler Test Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations-of-the-scaler-app">Limitations of the Scaler App</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#xma-transcoder-app">XMA Transcoder App</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#transcoder-build-instructions">Transcoder Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#transcoder-test-instructions">﻿Transcoder Test Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations-of-the-transcoder-app">Limitations of the Transcoder App</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../specs_and_features.html">Specs and Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../using_ffmpeg.html">Using FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../managing_compute_resources.html">Managing Compute Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deploying_with_kubernetes.html">Deploying with Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_apis.html">C API Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../card_management.html">Card Management</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/video-sdk/issues">File an issue</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/video-sdk/browse.html">Other versions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Xilinx Video SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../examples.html">Tutorials and Examples</a> &raquo;</li>
      <li>XMA Examples for the Xilinx Video SDK</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/examples/xma/xma_apps.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="xma-examples-for-the-sdk">
<h1>XMA Examples for the Xilinx Video SDK<a class="headerlink" href="#xma-examples-for-the-sdk" title="Permalink to this heading">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#build-and-test-instructions" id="id1">Build and Test Instructions</a></p></li>
<li><p><a class="reference internal" href="#xma-decoder-app" id="id2">XMA Decoder App</a></p></li>
<li><p><a class="reference internal" href="#xma-encoder-app" id="id3">XMA Encoder App</a></p></li>
<li><p><a class="reference internal" href="#xma-scaler-app" id="id4">XMA Scaler App</a></p></li>
<li><p><a class="reference internal" href="#xma-transcoder-app" id="id5">XMA Transcoder App</a></p></li>
</ul>
</div>
<p>The examples in the <code class="docutils literal notranslate"><span class="pre">examples/xma</span></code> folder illustrate how C-based applications can natively interact with Xilinx devices using the Xilinx Video SDK plugins and the XMA (Xilinx Media Accelerator) APIs. The examples are for advanced use-cases where using the FFmpeg command-line interface is not appropriate.</p>
<p>Detailed documentation on the Xilinx Video SDK plugin interface and the XMA APIs can be found in the <a class="reference internal" href="../../c_apis.html"><span class="doc">C API Programming Guide</span></a> section of the documentation.</p>
<div class="section" id="build-and-test-instructions">
<h2><a class="toc-backref" href="#id1">Build and Test Instructions</a><a class="headerlink" href="#build-and-test-instructions" title="Permalink to this heading">¶</a></h2>
<p>To build and test the sample XMA applications, the Xilinx Video SDK packages must be installed on the server, and the Xilinx devices must to be flashed with the shell provided in the release package.</p>
<p>To build and test all the XMA applications at once, run the following command from within the <code class="docutils literal notranslate"><span class="pre">./examples/xma</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source ./setup.sh
</pre></div>
</div>
<p>This script sets up the environment, builds all the applications and then runs a simple test to validate that each of the applications works correctly.
The executables are placed in the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory of the corresponding application subfolder.</p>
<p>To build and test each application individually, refer to the sections below.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="xma-decoder-app">
<span id="xma-decoder-example"></span><h2><a class="toc-backref" href="#id2">XMA Decoder App</a><a class="headerlink" href="#xma-decoder-app" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">examples/xma/decode_only</span></code> folder contains a standalone decoder application using the C APIs (XMA) of the Xilinx Video SDK to interact with the Xilinx video accelerators.</p>
<div class="section" id="decoder-build-instructions">
<h3>Decoder Build Instructions<a class="headerlink" href="#decoder-build-instructions" title="Permalink to this heading">¶</a></h3>
<p>Export the XRT and XRM environment variables needed to build the decoder application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xrt/setup.sh
source /opt/xilinx/xrm/setup.sh
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">exampes/xma/decode_only</span></code> directory, do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make clean
make
</pre></div>
</div>
<p>The resulting executable is placed in the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_decode
</pre></div>
</div>
</div>
<div class="section" id="decoder-test-instructions">
<h3>Decoder Test Instructions<a class="headerlink" href="#decoder-test-instructions" title="Permalink to this heading">¶</a></h3>
<p>The XMA decoder application supports most of the decode options supported by FFmpeg. The XMA application supports only NV12 semi-planar input and outputs NV12 encoded elementary stream. It ingests an H.264 or H.265 encoded file and utilizes hardware acceleration to get the decoded output.</p>
<div class="section" id="decoder-usage">
<h4>Decoder Usage<a class="headerlink" href="#decoder-usage" title="Permalink to this heading">¶</a></h4>
<p>Before running decoding application, source the xcdr environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<p>Running the decoder app with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> option will print the complete list of options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_decode --help
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This is a standalone xma decoder app. It ingests an h264 or h265 
encoded file and utilizes hardware acceleration to get the decoded 
output.

Usage: 
	./u30_xma_decode [options] -i &lt;input-file&gt; -c:v &lt;codec-type&gt; 
	[codec_options] -o &lt;output-file&gt;

Arguments:
	--help                     Print this message and exit
	-log &lt;level&gt;               Specify the log level
	-d &lt;device-id&gt;             Specify a device on which to run.
	                           Default: 0

Input Arguments:

	-stream_loop &lt;loop-count&gt;  Number of times to loop the input
	                           file
	-i &lt;input-file&gt;            Input file to be used

Codec Arguments:

	-c:v &lt;codec&gt;               Specify H264 or H265 decoding. 
	                           (mpsoc_vcu_h264, mpsoc_vcu_hevc)
	-low_latency               Should low latency decoding be used
	-entropy_buf_cnt &lt;count&gt;   Specify number of internal entropy
	                           buffers. [2-10], default: 2
	-latency_logging           Log latency information to syslog
	-splitbuff_mode            Configure decoder in split/unsplit
	                           input buffer mode
	-frames &lt;frame-count&gt;      Number of frames to be processed.
	-o &lt;file&gt;                  File to which output is written.

</pre></div>
</div>
</div>
<div class="section" id="sample-decoder-command">
<h4>Sample Decoder Command<a class="headerlink" href="#sample-decoder-command" title="Permalink to this heading">¶</a></h4>
<p>Decode an h264 encoded file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_decode  -i ~/CSGO_1920x1080_5000kbps.264 -c:v mpsoc_vcu_h264 -o ./CSGO_1920x1080.NV12
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
</div>
<div class="section" id="xma-encoder-app">
<span id="xma-encoder-example"></span><h2><a class="toc-backref" href="#id3">XMA Encoder App</a><a class="headerlink" href="#xma-encoder-app" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">examples/xma/encode_only</span></code> folder contains a standalone encoder application using the C APIs (XMA) of the Xilinx Video SDK to interact with the Xilinx video accelerators.</p>
<div class="section" id="encoder-build-instructions">
<h3>﻿Encoder Build Instructions<a class="headerlink" href="#encoder-build-instructions" title="Permalink to this heading">¶</a></h3>
<p>Export the XRT and XRM environment variables needed to build the encoder application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xrt/setup.sh
source /opt/xilinx/xrm/setup.sh
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">exampes/xma/encode_only</span></code> directory, do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make clean
make
</pre></div>
</div>
<p>The resulting executable is placed in the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_enc
</pre></div>
</div>
</div>
<div class="section" id="encoder-test-instructions">
<h3>﻿Encoder Test Instructions<a class="headerlink" href="#encoder-test-instructions" title="Permalink to this heading">¶</a></h3>
<p>The encoder XMA application supports most of the encoder options supported by FFmpeg. The XMA application supports only YUV 4:2:0 semi-planar input and outputs H.264/HEVC encoded elementary stream.</p>
<div class="section" id="encoder-usage">
<h4>Encoder Usage<a class="headerlink" href="#encoder-usage" title="Permalink to this heading">¶</a></h4>
<p>Before running encoder application, source the xcdr environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<p>Running the encoder app with the <code class="docutils literal notranslate"><span class="pre">-help</span></code> option will print the complete list of options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_enc -help
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> XMA Encoder App Usage: 
	./program [input options] -i input-file -c:v &lt;codec-option&gt;  [encoder options] -o &lt;output-file&gt;

Arguments:

	--help                     Print this message and exit.
	-d &lt;device-id&gt;             Specify a device on which the encoder 
	                           to run. Default: 0
	-frames &lt;frame-count&gt;      Number of frames to be processed.

Input options:

	-stream_loop &lt;loop-count&gt;  Number of times to loop the input YUV 
	                           file.
	-w &lt;width&gt;                 Width of YUV input. 
	-h &lt;height&gt;                Height of YUV input. 
	-pix_fmt &lt;pixel-format&gt;    Pixel format of the input file (yuv420p / nv12). 
	                           Default input file format will be chosen as nv12. 
	-i &lt;input-file&gt;            Name and path of input YUV file 

Codec option:
	-c:v &lt;codec&gt;               Encoder codec to be used. Supported 
	                           are mpsoc_vcu_hevc, mpsoc_vcu_h264 
Encoder params: 
	-b:v &lt;bitrate&gt;             Bitrate can be given in Kbps or Mbps 
	                           or bits i.e., 5000000, 5000K, 5M. 
	                           Default is 200kbps 
	-fps &lt;fps&gt;                 Input frame rate. Default is 25. 
	-g &lt;intraperiod&gt;           Intra period. Default is 12. 
	-control-rate &lt;mode&gt;       Rate control mode. Supported are 0 
	                           to 3, default is 1.
	-max-bitrate &lt;bitrate&gt;     Maximum bit rate. Supported are 0 to 
	                           350000000, default is 5000 
	-slice-qp &lt;qp&gt;             Slice QP. Supported are -1 to 51, 
	                           default is -1 
	-min-qp &lt;qp&gt;               Minimum QP. Supported are 0 to 51, 
	                           default is 0. 
	-max-qp &lt;qp&gt;               Maximum QP. Supported values are 0 
	                           to 51, default is 51. 
	-bf &lt;frames&gt;               Number of B frames. Supported are 0 
	                           to 7, default is 2. 
	-periodicity-idr &lt;value&gt;   IDR picture frequency. Supported are 
	                           0 to UINT32_MAX, default is 
	                           UINT32_MAX. 
	-profile &lt;value&gt;           Encoder profile. 
	           For HEVC, supported are 0 or main and 1 or main-intra. 
	                           Default is 0/main. 
	                           ENC_HEVC_MAIN - 0 or main. 
	                           ENC_HEVC_MAIN_INTRA - 1 or main-intra. 
	           For H264, supported are 66 or baseline, 77 or main, 
	                           100 or high, default is 100/high. 
	                           ENC_H264_BASELINE - 66 or baseline. 
	                           ENC_H264_MAIN - 77 or main. 
	                           ENC_H264_HIGH - 100 or high. 
	-level &lt;value&gt;             Encoder level. 
	                           For HEVC, supported are 10 to 51, 
	                           default is 50. 
	                           For H264, supported are 10 to 52, 
	                           default is 50. 
	-slices &lt;value&gt;            Number of slices per frame. Supported 
	                           are 1 to 68, default is 1. 
	-qp-mode &lt;mode&gt;            QP mode. Supported are 0, 1, and 2, 
	                           default is 1. 
	-aspect-ratio &lt;value&gt;      Aspect ratio. Supported values are 0 
	                           to 3, default is 0. 
	-scaling-list &lt;0/1&gt;        Scaling list. Enable/Disable, 
	                           default enable. 
	-lookahead-depth &lt;value&gt;   Lookahead depth. Supported are 0 to 
	                           20, default is 0. 
	-temporal-aq &lt;0/1&gt;         Temporal AQ. Enable/Disable, 
	                           default disable. 
	-spatial-aq &lt;0/1&gt;          Spatial AQ. Enable/Disable, 
	                           default disable. 
	-spatial-aq-gain &lt;value&gt;   Spatial AQ gain. Supported are 0 to 
	                           100, default is 50. 
	-cores &lt;value&gt;             Number of cores to use, supported are 
	                           0 to 4, default is 0. 
	-tune-metrics &lt;0/1&gt;        Tunes MPSoC H.264/HEVC encoder&#39;s video 
	                           quality for objective metrics, default 
	                           disable. 
	-latency_logging &lt;0/1&gt;     Enable latency logging in syslog.
	-o &lt;file&gt;                  File to which output is written.

</pre></div>
</div>
</div>
<div class="section" id="sample-encoder-commands">
<h4>Sample Encoder Commands<a class="headerlink" href="#sample-encoder-commands" title="Permalink to this heading">¶</a></h4>
<p>H.264 encoding, best objective score, low latency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_enc -w 1920 -h 1080  -i input_1080sp.yuv -c:v mpsoc_vcu_h264 -fps 60 -b:v 5000 -profile 2 -level 42 -g 120 -periodicity-idr 120 -qp-mode 0 -scaling-list 0 -bf 0 -o out1.264
</pre></div>
</div>
<p>H.264 encoding, best visual score, low latency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_enc -w 1920 -h 1080  -i input_1080sp.yuv -c:v mpsoc_vcu_h264 -fps 60 -b:v 5000 -profile 2 -level 42 -g 120 -periodicity-idr 120 -qp-mode 1 -bf 0 -o out2.264
</pre></div>
</div>
<p>HEVC encoding, best visual score, low latency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_enc -w 1920 -h 1080  -i input_1080sp.yuv -c:v mpsoc_vcu_hevc -fps 60 -b:v 4000 -g 120 -periodicity-idr 120 -qp-mode 1 -bf 0 -o out1.265
</pre></div>
</div>
<p>HEVC encoding, best visual score, normal latency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_enc -w 1920 -h 1080  -i input_1080sp.yuv -c:v mpsoc_vcu_hevc -fps 60 -b:v 4000 -g 120 -periodicity-idr 120 -qp-mode 3 -bf 1 -lookahead-depth 20 -temporal-aq 1 -spatial-aq 1 -o out2.265
</pre></div>
</div>
<p>For more examples, refer to the <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/xma/encode_only/test/scripts/enc_app_test.sh">examples/xma/encode_only/test/scripts/enc_app_test.sh</a> script.</p>
</div>
</div>
<div class="section" id="limitations-of-the-encoder-app">
<h3>Limitations of the Encoder App<a class="headerlink" href="#limitations-of-the-encoder-app" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>The encoder application assumes that the input YUV file is in NV12 format.</p></li>
<li><p>The application outputs only H264/HEVC elementary streams.</p></li>
<li><p>The application supports multi-process but not multi-channel.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="xma-scaler-app">
<span id="xma-scaler-example"></span><h2><a class="toc-backref" href="#id4">XMA Scaler App</a><a class="headerlink" href="#xma-scaler-app" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">examples/xma/scale_only</span></code> folder contains a standalone scaler application using the C APIs (XMA) of the Xilinx Video SDK to interact with the Xilinx video accelerators.</p>
<div class="section" id="scaler-build-instructions">
<h3>﻿Scaler Build Instructions<a class="headerlink" href="#scaler-build-instructions" title="Permalink to this heading">¶</a></h3>
<p>Export the XRT and XRM environment variables needed to build the scaler application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xrt/setup.sh
source /opt/xilinx/xrm/setup.sh
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">exampes/xma/scale_only</span></code> directory, do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make clean
make
</pre></div>
</div>
<p>The resulting executable is placed in the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_scale
</pre></div>
</div>
</div>
<div class="section" id="scaler-test-instructions">
<h3>﻿Scaler Test Instructions<a class="headerlink" href="#scaler-test-instructions" title="Permalink to this heading">¶</a></h3>
<p>The scaler XMA application supports most of the scaler options supported by FFmpeg. The XMA application supports only NV12 semi-planar input and outputs NV12 scaled elementary stream.</p>
<div class="section" id="scaler-usage">
<h4>Scaler Usage<a class="headerlink" href="#scaler-usage" title="Permalink to this heading">¶</a></h4>
<p>Before running scaler application, source the xcdr environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<p>Below is the list of all the options of the scaler app:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>This program ingests an NV12 input file and utilizes hardware acceleration to scale to various resolutions. 

Usage:
	./u30_xma_scale [options] -w &lt;input-width&gt; -h &lt;input-height&gt; -i 
	&lt;input-file&gt; [scaler_options] -w &lt;output-1-width&gt; -h 
	&lt;output-1-height&gt; -o &lt;output-1-file&gt; -w ...

Arguments:
	--help                     Print this message and exit
	-log &lt;level&gt;               Specify the log level
	-d &lt;device-id&gt;             Specify a device on which to run.
	                           Default: 0

Input Arguments:

	-stream_loop &lt;loop-count&gt;  Number of times to loop the input
	                           file
	-w &lt;width&gt;                 Specify the input&#39;s width
	-h &lt;height&gt;                Specify the input&#39;s height
	-pix_fmt &lt;fmt&gt;             Specify the input&#39;s pixel format.
	                           nv12 is the only format supported.
	-fps &lt;frame-rate&gt;          Frame rate. Used for scaler load
	                           calculation.
	-i &lt;input-file&gt;            Input file to be used

Output Arguments:
	-coeff_load &lt;load&gt;         Specify the coefficient load. 0 Auto 
	                           (default), 1 static, 2 FilterCoef.txt.
	-enable-pipeline           Enable scaler pipeline
	-rate &lt;half/full&gt;          Set the rate to half. Half rate drops 
	                           frames to reduce resource usage. 
	                           Default: full.
	-enable-latency-logging    Enable latency logging
	-w &lt;width&gt;                 Specify the output&#39;s width
	-h &lt;height&gt;                Specify the output&#39;s height
	-frames &lt;frame-count&gt;      Number of frames to be processed.
	-o &lt;file&gt;                  File to which output is written.

</pre></div>
</div>
</div>
<div class="section" id="sample-scaler-command">
<h4>Sample Scaler Command<a class="headerlink" href="#sample-scaler-command" title="Permalink to this heading">¶</a></h4>
<p>Scale 1080p nv12 to 720p, 480p, 360p, and 240p nv12:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_scale -w 1920 -h 1080 -i ~/Kimono1_1920x1080_24.yuvNV12 -w 1280 -h \
      720 -o Kimono_1280x720.NV12 -w 852 -h 480 -o Kimono_852x480.NV12 -w \
      640 -h 360 -o Kimono_640x360.NV12 -w 480 -h 240 -o Kimono_480x240.NV12
</pre></div>
</div>
</div>
</div>
<div class="section" id="limitations-of-the-scaler-app">
<h3>Limitations of the Scaler App<a class="headerlink" href="#limitations-of-the-scaler-app" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>The scaler supports nv12 format only</p></li>
<li><p>There may be a performance degradation relative to ffmpeg with a high number of outputs/processes.</p></li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="xma-transcoder-app">
<span id="xma-transcoder-example"></span><h2><a class="toc-backref" href="#id5">XMA Transcoder App</a><a class="headerlink" href="#xma-transcoder-app" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">examples/xma/transcode</span></code> folder contains a standalone transcoder application using the C APIs (XMA) of the Xilinx Video SDK to interact with the Xilinx video accelerators.</p>
<div class="section" id="transcoder-build-instructions">
<h3>Transcoder Build Instructions<a class="headerlink" href="#transcoder-build-instructions" title="Permalink to this heading">¶</a></h3>
<p>Export the XRT and XRM environment variables needed to build the transcoder application:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xrt/setup.sh
source /opt/xilinx/xrm/setup.sh
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">exampes/xma/transcode</span></code> directory, do the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make clean
make
</pre></div>
</div>
<p>The resulting executable is placed in the <code class="docutils literal notranslate"><span class="pre">build</span></code> directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./build/u30_xma_transcode
</pre></div>
</div>
</div>
<div class="section" id="transcoder-test-instructions">
<h3>﻿Transcoder Test Instructions<a class="headerlink" href="#transcoder-test-instructions" title="Permalink to this heading">¶</a></h3>
<p>The transcoder XMA application supports most of the options supported by ffmpeg. The XMA application supports only elementary H.264 and HEVC encoded stream input and outputs H.264/HEVC encoded elementary stream.</p>
<div class="section" id="transcoder-usage">
<h4>Transcoder Usage<a class="headerlink" href="#transcoder-usage" title="Permalink to this heading">¶</a></h4>
<p>Before running transcoder application, source the xcdr environment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>source /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<p>Running the transcoder app with the <code class="docutils literal notranslate"><span class="pre">--help</span></code> option will print the complete list of options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_transcode --help
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> XMA Transcoder App Usage: 
	./program [generic options] -c:v &lt;decoder codec&gt; [decoder options]  -i input-file -multiscale_xma -outputs [num] [Scaler options]  -c:v &lt;encoder codec&gt; [encoder options] -o &lt;output-file&gt;  -c:v &lt;encoder codec&gt; [encoder options] -o &lt;output-file&gt;  -c:v &lt;encoder codec&gt; [encoder options] -o &lt;output-file&gt;..... 

Arguments:

	--help                     Print this message and exit.
	-d &lt;device-id&gt;             Specify a device on which the 
	                           transcoder to run. Default: 0
	-stream_loop &lt;loop-count&gt;  Number of times to loop the input file 
	-frames &lt;frame-count&gt;      Number of input frames to be processed 
	                           
Decoder options:

	-c:v &lt;codec&gt;               Decoder codec to be used. Supported 
	                           are mpsoc_vcu_hevc, mpsoc_vcu_h264 
	-low-latency &lt;0/1&gt;         Low latency for decoder. Default 
	                           disabled 
	-latency_logging &lt;0/1&gt;     Latency logging for decoder. Default 
	                           disabled 
	-i &lt;input-file&gt;            Name and path of input H.264/HEVC file 
	                           
Scaler options:

	-multiscale_xma            Name of the ABR scaler filter 
	-num-output &lt;value&gt;        Number of output files from scaler 
	-out_1_width &lt;width&gt;       Width of the scaler output channel 1 
	-out_1_height &lt;height&gt;     Height of the scaler output channel 1 
	-out_1_rate &lt;full/half&gt;    Full of Half rate for output channel 1 
	-out_2_width &lt;width&gt;       Width of the scaler output channel 2 
	-out_2_height &lt;height&gt;     Height of the scaler output channel 2 
	-out_2_rate &lt;full/half&gt;    Full of Half rate for output channel 2 
	-out_3_width &lt;width&gt;       Width of the scaler output channel 3 
	-out_3_height &lt;height&gt;     Height of the scaler output channel 3 
	-out_3_rate &lt;full/half&gt;    Full of Half rate for output channel 3 
	-out_4_width &lt;width&gt;       Width of the scaler output channel 4 
	-out_4_height &lt;height&gt;     Height of the scaler output channel 4 
	-out_4_rate &lt;full/half&gt;    Full of Half rate for output channel 4 
	-out_5_width &lt;width&gt;       Width of the scaler output channel 5 
	-out_5_height &lt;height&gt;     Height of the scaler output channel 5 
	-out_5_rate &lt;full/half&gt;    Full of Half rate for output channel 5 
	-out_6_width &lt;width&gt;       Width of the scaler output channel 6 
	-out_6_height &lt;height&gt;     Height of the scaler output channel 6 
	-out_6_rate &lt;full/half&gt;    Full of Half rate for output channel 6 
	-out_7_width &lt;width&gt;       Width of the scaler output channel 7 
	-out_7_height &lt;height&gt;     Height of the scaler output channel 7 
	-out_7_rate &lt;full/half&gt;    Full of Half rate for output channel 7 
	-out_8_width &lt;width&gt;       Width of the scaler output channel 8 
	-out_8_height &lt;height&gt;     Height of the scaler output channel 8 
	-out_8_rate &lt;full/half&gt;    Full of Half rate for output channel 8 
	-latency_logging &lt;0/1&gt;     Latency logging for scaler. Default 
	                           disabled 
Encoder options:

	-c:v &lt;codec&gt;               Encoder codec to be used. Supported 
	                           are mpsoc_vcu_hevc, mpsoc_vcu_h264 
	-b:v &lt;bitrate&gt;             Bitrate can be given in Kbps or Mbps 
	                           or bits i.e., 5000000, 5000K, 5M. 
	                           Default is 200kbps 
	-fps &lt;fps&gt;                 Input frame rate. Default is 25. 
	-g &lt;intraperiod&gt;           Intra period. Default is 12. 
	-control-rate &lt;mode&gt;       Rate control mode. Supported are 0 
	                           to 3, default is 1.
	-max-bitrate &lt;bitrate&gt;     Maximum bit rate. Supported are 0 to 
	                           350000000, default is 5000 
	-slice-qp &lt;qp&gt;             Slice QP. Supported are -1 to 51, 
	                           default is -1 
	-min-qp &lt;qp&gt;               Minimum QP. Supported are 0 to 51, 
	                           default is 0. 
	-max-qp &lt;qp&gt;               Maximum QP. Supported values are 0 
	                           to 51, default is 51. 
	-bf &lt;frames&gt;               Number of B frames. Supported are 0 
	                           to 7, default is 2. 
	-periodicity-idr &lt;value&gt;   IDR picture frequency. Supported are 
	                           0 to UINT32_MAX, default is 
	                           UINT32_MAX. 
	-profile &lt;value&gt;           Encoder profile. 
	           For HEVC, supported are 0 or main and 1 or main-intra. 
	                           Default is 0. 
	           For H264, supported are 66 or baseline, 77 or main 
	                           and 100 or high. Default is 100 
	-level &lt;value&gt;             Encoder level. 
	                           For HEVC, supported are 10 to 51, 
	                           default is 50. 
	                           For H264, supported are 10 to 52, 
	                           default is 50. 
	-slices &lt;value&gt;            Number of slices per frame. Supported 
	                           are 1 to 68, default is 1. 
	-qp-mode &lt;mode&gt;            QP mode. Supported are 0, 1, and 2, 
	                           default is 1. 
	-aspect-ratio &lt;value&gt;      Aspect ratio. Supported values are 0 
	                           to 3, default is 0. 
	-scaling-list &lt;0/1&gt;        Scaling list. Enable/Disable, 
	                           default enable. 
	-lookahead-depth &lt;value&gt;   Lookahead depth. Supported are 0 to 
	                           20, default is 0. 
	-temporal-aq &lt;0/1&gt;         Temporal AQ. Enable/Disable, 
	                           default disable. 
	-spatial-aq &lt;0/1&gt;          Spatial AQ. Enable/Disable, 
	                           default disable. 
	-spatial-aq-gain &lt;value&gt;   Spatial AQ gain. Supported are 0 to 
	                           100, default is 50. 
	-cores &lt;value&gt;             Number of cores to use, supported are 
	                           0 to 4, default is 0. 
	-tune-metrics &lt;0/1&gt;        Tunes MPSoC H.264/HEVC encoder&#39;s video 
	                           quality for objective metrics, default 
	                           disable. 
	-latency_logging &lt;0/1&gt;     Enable latency logging in syslog.
	-o &lt;file&gt;                  File to which output is written.

</pre></div>
</div>
</div>
<div class="section" id="sample-transcoder-commands">
<h4>Sample Transcoder Commands<a class="headerlink" href="#sample-transcoder-commands" title="Permalink to this heading">¶</a></h4>
<p>H.264 to HEVC ABR Transcoder:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_transcode -c:v mpsoc_vcu_h264 -i input_1080p.264 -multiscale_xma -num-output 4 -out_1_width 1280 -out_1_height 720 -out_2_width 848 -out_2_height 480 -out_3_width 640 -out_3_height 360 -out_4_width 288 -out_4_height 160 \
-c:v mpsoc_vcu_hevc -b:v 4000K  -o out1_test1.265 -c:v mpsoc_vcu_hevc -b:v 3000K -o out1_test2.265 -c:v mpsoc_vcu_hevc -b:v 2500K -o out1_test3.265 -c:v mpsoc_vcu_hevc -b:v 1250K -o out1_test4.265 -c:v mpsoc_vcu_hevc -b:v 625K -o out1_test5.265
</pre></div>
</div>
<p>HEVC ABR Transcoder with Look-Ahead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_transcode -c:v mpsoc_vcu_hevc -i input_1080p.265 -multiscale_xma -num-output 4 -out_1_width 1280 -out_1_height 720 -out_2_width 848 -out_2_height 480 -out_3_width 640 -out_3_height 360 -out_4_width 288 -out_4_height 160 \
-c:v mpsoc_vcu_hevc -b:v 4000K -qp-mode 3 -lookahead-depth 16 -temporal-aq 1 -spatial-aq 1 -spatial-aq-gain 75 -o out_la_test1.265 -c:v mpsoc_vcu_hevc -b:v 3000K -qp-mode 3 -lookahead-depth 16 -temporal-aq 1 -spatial-aq 1 -spatial-aq-gain 75 -o out_la_test2.265 \
-c:v mpsoc_vcu_hevc -b:v 2500K -qp-mode 3 -lookahead-depth 16 -temporal-aq 1 -spatial-aq 1 -spatial-aq-gain 75 -o out_la_test3.265 -c:v mpsoc_vcu_hevc -b:v 1250K -qp-mode 3 -lookahead-depth 16 -temporal-aq 1 -spatial-aq 1 -spatial-aq-gain 75 -o out_la_test4.265 \
-c:v mpsoc_vcu_hevc -b:v 625K -qp-mode 3 -lookahead-depth 16 -temporal-aq 1 -spatial-aq 1 -spatial-aq-gain 75 -o out_la_test5.265
</pre></div>
</div>
<p>H.264 to HEVC ABR Transcoder with Scaler Pipeline:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./u30_xma_transcode -c:v mpsoc_vcu_h264 -i input_1080p.264 -multiscale_xma -num-output 4 -out_1_width 1280 -out_1_height 720 -out_2_width 848 -out_2_height 480 -out_3_width 640 -out_3_height 360 -out_4_width 288 -out_4_height 160 \
-c:v mpsoc_vcu_hevc -b:v 4000K  -o out3_sc_test1.265 -c:v mpsoc_vcu_hevc -b:v 3000K -o out3_sc_test2.265 -c:v mpsoc_vcu_hevc -b:v 2500K -o out3_sc_test3.265 -c:v mpsoc_vcu_hevc -b:v 1250K -o out3_sc_test4.265 -c:v mpsoc_vcu_hevc -b:v 625K -o out3_sc_test5.265
</pre></div>
</div>
<p>For more examples, refer to the <a class="reference external" href="https://github.com/Xilinx/video-sdk/blob/v1.5/examples/xma/transcode/test/scripts/transcoder_app_test.sh">examples/xma/transcode/test/scripts/transcoder_app_test.sh</a> script.</p>
</div>
</div>
<div class="section" id="limitations-of-the-transcoder-app">
<h3>Limitations of the Transcoder App<a class="headerlink" href="#limitations-of-the-transcoder-app" title="Permalink to this heading">¶</a></h3>
<ul class="simple">
<li><p>The transcoder application supports only elementary H264/HEVC encoded streams as input file. It cannot parse container formats like MP4, AVI, etc.</p></li>
<li><p>The transcoder outputs only H264/HEVC elementary streams.</p></li>
<li><p>The lookahead depth should be same for all the channels.</p></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../ffmpeg/quality_analysis.html" class="btn btn-neutral float-left" title="Video Quality Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../specs_and_features.html" class="btn btn-neutral float-right" title="Specs and Features of the Xilinx Video SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on May 18, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>